<!-- 
💎 Dodva 白金版 · Loop 基底
⚠️ 请不要修改此版本，只用于保存最纯粹的四分类混音逻辑。
未来扩展请复制本文件（例如：white-noise.pro.html / meditation.html）。
-->

<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva · 白噪音控制台（Loop 基底）</title>
<meta name="theme-color" content="#0b0f1a">
<style>
  :root{
    --bg:#0b0f1a; --fg:#eaf2ff; --muted:#a3b4d8; --line:rgba(147,197,253,.18);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);
       font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans SC",sans-serif}
  header{position:sticky;top:0;display:flex;gap:10px;align-items:center;
    padding:10px 16px;background:linear-gradient(180deg,rgba(10,16,34,.55),rgba(10,16,34,.35));
    border-bottom:1px solid var(--line);backdrop-filter:blur(10px)}
  header a{color:#cde3ff;text-decoration:none;border:1px solid var(--line);
    padding:8px 12px;border-radius:999px}
  .brand{margin-left:auto;opacity:.85}
  .wrap{max-width:1000px;margin:0 auto;padding:20px 16px 80px}
  h1{margin:.1em 0 .4em}
  p.sub{opacity:.9;color:#d9e6ff;margin:.2em 0 1.2em}
  section{border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;
    background:linear-gradient(180deg,rgba(10,16,34,.55),rgba(10,16,34,.35))}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{background:rgba(147,197,253,.08);border:1px solid var(--line);color:var(--fg);
    padding:8px 12px;border-radius:10px;cursor:pointer}
  .pill{background:linear-gradient(135deg,#a5b4fc,#67e8f9,#f0abfc);color:#051019;
    font-weight:800;border:none;cursor:pointer;padding:10px 14px;border-radius:12px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);
    background:rgba(147,197,253,.06);cursor:pointer}
  .chip.on{background:rgba(147,197,253,.18);box-shadow:0 0 0 1px rgba(147,197,253,.25) inset}
  .vol{display:flex;align-items:center;gap:8px}
  .hint{font-size:13px;color:var(--muted)}
  .state{font-size:13px;color:var(--muted);min-height:1.4em}
  footer{margin-top:28px;text-align:center;color:#a3b4d8;font-size:13px;opacity:.9}
</style>
</head>
<body>
<header>
  <a href="./index.html">← 返回宇宙入口</a>
  <div class="brand">🎧 Dodva · 白噪音控制台 · Loop 基底</div>
</header>

<div class="wrap">
  <h1>白噪音控制台（四分类混音）</h1>
  <p class="sub">点开芯片即可播放/暂停；每类有独立音量；支持多轨叠加。首次需任意点击以授权播放。</p>

  <!-- 总控 -->
  <section>
    <h3>⚡ 总控</h3>
    <div class="row">
      <button class="pill" id="playAll">▶ 播放（恢复上次）</button>
      <button class="btn"  id="stopAll">⏹ 停止全部</button>
      <label class="vol">总音量
        <input id="masterVol" type="range" min="0" max="1" step="0.01" value="0.4">
      </label>
      <button class="btn" id="randomMix">✨ 随机混音</button>
    </div>
    <div id="globalState" class="state" style="margin-top:6px">准备好啦～</div>
  </section>

  <!-- 四分类 -->
  <section>
    <h3>🌳 森林 & 雨林</h3>
    <div class="chips" data-cat="forest">
      <div class="chip" data-key="crickets">夏夜虫鸣</div>
      <div class="chip" data-key="leaves-wind">林叶风</div>
      <div class="chip" data-key="stream-soft">远溪声</div>
    </div>
    <div class="row">
      <label class="vol">森林音量
        <input class="catVol" data-cat="forest" type="range" min="0" max="1" step="0.01" value="0.35">
      </label>
      <span class="hint">可多选叠加</span>
    </div>
  </section>

  <section>
    <h3>🌧️ 雨声 & 雷声</h3>
    <div class="chips" data-cat="rain">
      <div class="chip" data-key="window-rain">窗沿雨</div>
      <div class="chip" data-key="distant-thunder">远雷</div>
    </div>
    <div class="row">
      <label class="vol">雨声音量
        <input class="catVol" data-cat="rain" type="range" min="0" max="1" step="0.01" value="0.30">
      </label>
    </div>
  </section>

  <section>
    <h3>🌊 海洋</h3>
    <div class="chips" data-cat="ocean">
      <div class="chip" data-key="waves-1">海浪</div>
      <div class="chip" data-key="wind-sea">海风</div>
    </div>
    <div class="row">
      <label class="vol">海洋音量
        <input class="catVol" data-cat="ocean" type="range" min="0" max="1" step="0.01" value="0.30">
      </label>
    </div>
  </section>

  <section>
    <h3>🔥 舒缓 / 频率</h3>
    <div class="chips" data-cat="relax">
      <div class="chip" data-key="fireplace-1">壁炉火苗</div>
      <div class="chip" data-key="space-hum-60hz">太空低频 60Hz</div>
      <div class="chip" data-key="heart-40hz">心跳 40Hz</div>
      <div class="chip" data-key="528hz">528Hz</div>
    </div>
    <div class="row">
      <label class="vol">舒缓音量
        <input class="catVol" data-cat="relax" type="range" min="0" max="1" step="0.01" value="0.25">
      </label>
    </div>
  </section>

  <footer>© 2025 Dodva Universe · Loop Base</footer>
</div>

<!-- ====== 纯净播放器逻辑（无任何解锁/语音/外部依赖） ====== -->
<script>
const AUDIO_ROOT = '/assets/audio/'; // 你的音频根路径
const LIB = {
  forest: { 'crickets':AUDIO_ROOT+'forest/crickets.mp3', 'leaves-wind':AUDIO_ROOT+'forest/leaves-wind.mp3', 'stream-soft':AUDIO_ROOT+'forest/stream-soft.mp3' },
  rain:   { 'window-rain':AUDIO_ROOT+'rain/window-rain.mp3', 'distant-thunder':AUDIO_ROOT+'rain/distant-thunder.mp3' },
  ocean:  { 'waves-1':AUDIO_ROOT+'ocean/waves-1.mp3', 'wind-sea':AUDIO_ROOT+'ocean/wind-sea.mp3' },
  relax:  { 'fireplace-1':AUDIO_ROOT+'relax/fireplace-1.mp3', 'space-hum-60hz':AUDIO_ROOT+'relax/space-hum-60hz.mp3', 'heart-40hz':AUDIO_ROOT+'relax/heart-40hz.mp3', '528hz':AUDIO_ROOT+'relax/528hz.mp3' }
};

const $  = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));
const stateEl = $('#globalState');

const players = {}; // { cat: { key: HTMLAudioElement } }
const catVolume = { forest:.35, rain:.30, ocean:.30, relax:.25 };
let masterVol = .4;

function clamp01(v){ v=+v; return Math.max(0, Math.min(1, isNaN(v)?0:v)); }
function ensure(cat,key){
  players[cat] ??= {};
  if (!players[cat][key]){
    const a = new Audio(LIB[cat][key]);
    a.loop = true; a.preload = 'auto';
    a.volume = clamp01(catVolume[cat] * masterVol);
    players[cat][key] = a;
  }
  return players[cat][key];
}
function updateAllVolumes(){
  for (const [cat,items] of Object.entries(players)){
    for (const a of Object.values(items)){
      a.volume = clamp01(catVolume[cat] * masterVol);
    }
  }
}

// 芯片开关
$$('.chips').forEach(group=>{
  const cat = group.dataset.cat;
  group.addEventListener('click', async (e)=>{
    const chip = e.target.closest('.chip'); if(!chip) return;
    const key = chip.dataset.key;
    const a = ensure(cat,key);
    if (chip.classList.contains('on')){ a.pause(); chip.classList.remove('on'); stateEl.textContent=`已暂停：${cat}/${key}`; }
    else{
      a.volume = clamp01(catVolume[cat] * masterVol);
      try{ await a.play(); chip.classList.add('on'); stateEl.textContent=`播放中：${cat}/${key}`; }
      catch{ stateEl.textContent='提示：请先点击任意按钮以授权音频'; }
    }
  });
});

// 分类音量
$$('.catVol').forEach(r=>{
  r.addEventListener('input', e=>{
    catVolume[e.target.dataset.cat] = clamp01(e.target.value);
    updateAllVolumes();
  });
});

// 总控
$('#masterVol')?.addEventListener('input', e=>{ masterVol = clamp01(e.target.value); updateAllVolumes(); });
$('#stopAll')?.addEventListener('click', ()=>{
  for (const items of Object.values(players)){
    for (const a of Object.values(items)) a.pause();
  }
  $$('.chip.on').forEach(c=>c.classList.remove('on'));
  stateEl.textContent = '全部已停止';
});
$('#playAll')?.addEventListener('click', async ()=>{
  const onCount = $$('.chip.on').length;
  if (!onCount){
    [['rain','window-rain'],['forest','crickets'],['ocean','waves-1']].forEach(([cat,key])=>{
      document.querySelector(`.chips[data-cat="${cat}"] .chip[data-key="${key}"]`)?.click();
    });
  } else {
    for (const c of $$('.chip.on')){
      const cat = c.parentElement.dataset.cat, key = c.dataset.key;
      try{ await ensure(cat,key).play(); }catch{}
    }
  }
  stateEl.textContent = '播放就绪 ✓';
});
$('#randomMix')?.addEventListener('click', ()=>{
  $('#stopAll').click();
  Object.entries(LIB).forEach(([cat,obj])=>{
    const keys = Object.keys(obj);
    if (Math.random()<0.7){
      const key = keys[(Math.random()*keys.length)|0];
      document.querySelector(`.chips[data-cat="${cat}"] .chip[data-key="${key}"]`)?.click();
    }
  });
  stateEl.textContent = '随机混音就绪 ✨';
});
</script>

</script>

<!-- 先引入依赖的 JS 文件 -->
<script src="assets/js/momo-lines.js"></script>
<script src="assets/js/mix-player.js"></script>

<!-- 最后初始化 -->
<script>
  MomoLines.init();
</script>
</body>
</html>