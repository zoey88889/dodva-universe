<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva · Leaf 地图</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<meta name="theme-color" content="#0b0f1a">
<style>
  html,body,#map{height:100%;margin:0}
  body{background:#0b0f1a;color:#eaf2ff;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans SC",sans-serif}
  .back-home{
    position:fixed;left:12px;top:12px;z-index:10000;
    padding:8px 12px;border-radius:999px;
    color:#eaf2ff;text-decoration:none;font:14px/1 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:linear-gradient(135deg,rgba(165,180,252,.2),rgba(103,232,249,.2),rgba(240,171,252,.2));
    border:1px solid rgba(147,197,253,.35);backdrop-filter:blur(8px);
    box-shadow:0 0 14px rgba(103,232,249,.25), inset 0 0 0 1px rgba(255,255,255,.05);
  }
  .title{position:fixed;left:12px;top:58px;z-index:1000;color:#fff;opacity:.9}
  .status{position:fixed;right:12px;bottom:12px;z-index:1000;color:#fff;background:rgba(0,0,0,.45);
    padding:8px 10px;border-radius:10px;font-size:13px;white-space:pre-wrap}
  .beacon{width:16px;height:16px;border-radius:50%;position:relative}
  .rose{background:radial-gradient(circle at 30% 30%,#fff,#ffb3d9 45%,#ff6bb3 62%,#140915 72%);
        box-shadow:0 0 10px 3px rgba(255,179,217,.9),0 0 24px rgba(255,107,179,.55)}
  .blue{background:radial-gradient(circle at 30% 30%,#fff,#7dd3fc 45%,#0ea5e9 62%,#0b0f1a 72%);
        box-shadow:0 0 10px 3px rgba(125,211,252,.85),0 0 24px rgba(14,165,233,.5)}
  .pulse::before,.pulse::after{content:'';position:absolute;left:50%;top:50%;
    transform:translate(-50%,-50%);width:16px;height:16px;border-radius:50%;
    border:2px solid rgba(255,255,255,.55);animation:wave 2.6s ease-out infinite}
  .pulse::after{animation-delay:1.3s;opacity:.7}
  @keyframes wave{0%{width:16px;height:16px;opacity:.9}100%{width:120px;height:120px;opacity:0}}
</style>
</head>
<body>
<a id="backHome" class="back-home" href="/">← 返回宇宙入口</a>
<div class="title">Dodva · 我们的灯塔 ✨</div>
<div id="map"></div>
<div id="status" class="status">加载中…</div>
<footer>© 2025 Dodva Universe Co️nnect ®🌌 创造·连接·无限·永恒 ∞</footer>
<!-- Dodva 跨页播放器（会恢复上次场景；首次任意点击后继续播） -->
<script src="assets/js/dodva-audio.js"></script>
<script>DodvaAudio.init({ root: 'assets/audio/', dock: true });</script>

<!-- 返回按钮自适应（GitHub Pages 子路径时用 ./index.html） -->
<script>
(function(){
  var a=document.getElementById('backHome'); if(!a) return;
  var parts=location.pathname.replace(/\/+$/,'').split('/').filter(Boolean);
  var isGitHub=location.hostname.endsWith('github.io');
  if (isGitHub || parts.length>=2) a.href='./index.html';
})();
</script>

<script>
const LIGHTS = {
  A:{name:'A · 玫瑰初遇', lat:48.8566, lng:  2.3522, note:'第一眼就心动', cls:'rose'},
  B:{name:'B · 极光晨光', lat:64.1466, lng:-21.9426, note:'极光退场，晨光作证', cls:'blue'},
  C:{name:'C · 海边拥抱', lat:18.2528, lng:109.5119, note:'落日把我们抱紧', cls:'rose'},
  D:{name:'D · 雨夜心跳', lat:35.0116, lng:135.7681, note:'雨声里有你的心跳', cls:'blue'},
  E:{name:'E · 初见笑光', lat:31.2304, lng:121.4737, note:'那天你笑得像光', cls:'rose'},
  F:{name:'F · 秘密海边', lat:24.4798, lng:118.0894, note:'海风把你推给我', cls:'blue'},
  G:{name:'G · 小屋与雨', lat:30.5728, lng:104.0668, note:'雨夜抱紧不放手', cls:'rose'},
  H:{name:'H · 归途之吻', lat:22.5431, lng:114.0579, note:'离别时你吻我说回家', cls:'blue'}
};

const map = L.map('map',{minZoom:2,maxZoom:19});
L.tileLayer('https://{s}.ile.openstreetmap.org/{z}/{x}/{y}.png', { // 故意拼错的子域? 修正为 tile
  attribution:'© OpenStreetMap'}).addTo(map);
</script>
<script>
// 修正：正确的 OSM 瓦片地址
(function(){
  // 如果上一段加载失败（子域拼写错误），我们重新挂上正确的
  try{
    // 移除所有图层后添加正确地址
    map.eachLayer(l=>map.removeLayer(l));
  }catch(e){}
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'© OpenStreetMap'}).addTo(map);
})();
const bounds = L.latLngBounds(Object.values(LIGHTS).map(t=>[t.lat,t.lng]));
map.fitBounds(bounds.pad(0.35));
function icon(cls){ return L.divIcon({className:'',html:`<div class="beacon ${cls} pulse"></div>`,iconSize:[16,16],iconAnchor:[8,8]}); }
const markers = {};
for (const k of Object.keys(LIGHTS)){
  const t = LIGHTS[k];
  markers[k] = L.marker([t.lat,t.lng],{icon:icon(t.cls)})
    .addTo(map)
    .bindPopup(`<b>${t.name}</b><br>Lat ${t.lat.toFixed(5)}, Lng ${t.lng.toFixed(5)}<br>${t.note||''}`);
}
const path = L.polyline(Object.keys(LIGHTS).map(k=>[LIGHTS[k].lat,LIGHTS[k].lng]),
  {color:'#ff99cc',weight:3,opacity:.9}).addTo(map);
L.polyline(path.getLatLngs(),{color:'#ff66b3',weight:8,opacity:.25}).addTo(map);

map.on('dblclick', e=>{
  const s = `📍 双击坐标\nLat ${e.latlng.lat.toFixed(6)}, Lng ${e.latlng.lng.toFixed(6)}`;
  document.getElementById('status').textContent = s;
});
document.getElementById('status').textContent = '双击地图可复制坐标，替换成我们的私密地点 💞';
</script>
<script src="assets/js/mix-player.js?v=2"></script>
<script>MixPlayer.init({ dock: true });</script>
</body>
</html>