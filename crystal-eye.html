<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva Â· ç²‰æ™¶å†¥æƒ³</title>
<style>
  :root{--bg:#0b0f1a;--fg:#eef3ff;--mut:#a3b4d8;--line:#2a2f48}
  html,body{margin:0;background:radial-gradient(900px 600px at 70% -10%,rgba(255,182,193,.14),transparent 60%),#0b0f1a;color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;padding:10px 14px;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(180deg,rgba(14,14,22,.7),rgba(14,14,22,.45));backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .btn{border:1px solid #3b3f59;border-radius:10px;padding:7px 12px;background:#12121b;color:#eaf2ff;cursor:pointer}
  .wrap{max-width:920px;margin:0 auto;padding:16px}
  .panel{border:1px solid var(--line);border-radius:16px;padding:16px;background:linear-gradient(180deg,rgba(14,14,22,.9),rgba(14,14,22,.6));box-shadow:0 10px 28px rgba(0,0,0,.45)}
  .mut{color:var(--mut);font-size:13px}
  .ring{width:180px;height:180px;border-radius:50%;margin:6px auto;background:
    radial-gradient(60px 60px at 50% 55%,rgba(255,255,255,.12),transparent 60%),
    radial-gradient(600px 400px at 50% -20%,rgba(255,192,203,.16),transparent 60%),
    #0b0f1a;border:1px solid var(--line);display:grid;place-items:center;transition:transform .6s ease}
  .ring.big{transform:scale(1.06)}
  .h{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px}
  select{border:1px solid #3b3f59;background:#12121b;color:#eaf2ff;border-radius:10px;padding:7px 10px}
  label{display:inline-flex;gap:6px;align-items:center}
</style>
</head>
<body>
<header>
  <div class="h">
    <a class="btn" href="index.html">ğŸ  Home</a >
    <button class="btn" onclick="DUi18n.toggle()" id="langBtn">ğŸŒ EN/ä¸­æ–‡</button>
  </div>
  <button class="btn" onclick="duPay.modal()" data-i18n="cta.subscribe">ğŸ’ è®¢é˜… Pro</button>
</header>

<div class="wrap">
  <div class="panel">
    <h2 style="margin:.2em 0" data-i18n="med.title">ç²‰æ™¶å†¥æƒ³ Â· å‘¼å¸å¼•å¯¼</h2>
    <p class="mut" data-i18n="med.tip">è·Ÿéšå…‰ç¯ï¼šå¸æ°” 4ï½œåœ 4ï½œå‘¼æ°” 6ã€‚é€‰æ‹©é¢‘ç‡ä¸ç¯å¢ƒå±‚ï¼ŒæŒ‰ã€Œå¼€å§‹ã€ã€‚</p >

    <div class="ring" id="ring"><div id="timer" class="mut">00:00</div></div>

    <div class="h">
      <button class="btn" id="startBtn" data-i18n="med.start">å¼€å§‹</button>
      <button class="btn" id="pauseBtn" data-i18n="med.pause">æš‚åœ</button>
      <button class="btn" id="resetBtn" data-i18n="med.reset">é‡ç½®</button>
      <select id="hz">
        <option value="432">432Hz</option>
        <option value="528" selected>528Hz</option>
        <option value="639">639Hz</option>
      </select>
      <label><input type="checkbox" id="envRain"/> ğŸŒ§ Rain</label>
      <label><input type="checkbox" id="envForest"/> ğŸŒ² Forest</label>
      <label><input type="checkbox" id="envOcean"/> ğŸŒŠ Ocean</label>
      <label><input type="checkbox" id="pink"/> Pink</label>
    </div>
  </div>
</div>

<script src="du-i18n.js"></script>
<script src="du-pay.js"></script>
<script>
    
// ===== WebAudio å¼•æ“ï¼ˆçº¯å‰ç«¯æ— å¤–é“¾ï¼‰ =====
let AC, master, toneOsc, toneGain, noiseNode, noiseGain;
let env = {rain:null, forest:null, ocean:null};
function ensureAC(){
  if (AC) return;
  AC = new (window.AudioContext||window.webkitAudioContext)();
  master = AC.createGain(); master.gain.value=0.8; master.connect(AC.destination);
  // ä¸»æ—‹å¾‹ï¼šæ­£å¼¦ + è½»é—¨é™
  toneOsc = AC.createOscillator(); toneOsc.type='sine';
  toneGain= AC.createGain(); toneGain.gain.value=0.0;
  toneOsc.connect(toneGain); toneGain.connect(master); toneOsc.start();

  // ç²‰å™ªï¼šç”¨ç™½å™ª+æ»¤æ³¢è¿‘ä¼¼
  noiseGain = AC.createGain(); noiseGain.gain.value=0.0; noiseGain.connect(master);
  noiseNode = AC.createBufferSource();
  const buf = AC.createBuffer(1, AC.sampleRate*2, AC.sampleRate);
  const d = buf.getChannelData(0);
  for(let i=0;i<d.length;i++){ d[i] = Math.random()*2-1; } // white
  noiseNode.buffer=buf; noiseNode.loop=true;
  // 3 æ®µæ»¤æ³¢å åŠ è¿‘ä¼¼ pink
  const b1=AC.createBiquadFilter(); b1.type='lowpass'; b1.frequency.value=800;
  const b2=AC.createBiquadFilter(); b2.type='lowpass'; b2.frequency.value=1600;
  const b3=AC.createBiquadFilter(); b3.type='highpass'; b3.frequency.value=40;
  noiseNode.connect(b1); b1.connect(b2); b2.connect(b3); b3.connect(noiseGain);
  noiseNode.start();
}

function setFreq(hz){ if(!AC) return; toneOsc.frequency.setValueAtTime(+hz, AC.currentTime); }
function fade(param, to, ms=300){
  const t=AC.currentTime; param.cancelScheduledValues(t);
  param.linearRampToValueAtTime(to, t + ms/1000);
}

// ç¯å¢ƒå±‚ï¼šç”¨ä¸åŒæ»¤æ³¢ä¸ LFO æ¨¡æ‹Ÿ
function envOn(name, on){
  if(!AC) return;
  if(on && !env[name]){
    const g = AC.createGain(); g.gain.value=0.0; g.connect(master);
    const src = AC.createBufferSource(); src.buffer=noiseNode.buffer; src.loop=true;
    const f = AC.createBiquadFilter(); f.type = (name==='ocean'?'lowpass':'bandpass');
    f.frequency.value = name==='rain'? 4000 : name==='forest'? 2500 : 400;
    f.Q.value = name==='rain'? 0.7 : name==='forest'? 1.2 : 0.8;
    // LFO
    const lfo = AC.createOscillator(); const lfoGain=AC.createGain();
    lfo.frequency.value = name==='ocean'? 0.08 : name==='forest'? 0.3 : 0.6;
    lfoGain.gain.value = name==='ocean'? 0.28 : name==='forest'? 0.12 : 0.06;
    lfo.connect(lfoGain); lfoGain.connect(g.gain);

    src.connect(f); f.connect(g); src.start(); lfo.start();
    env[name]={g,src,lfo,lfoGain};
    fade(g.gain, name==='rain'?0.18: name==='forest'?0.14: 0.2, 600);
  }
  if(!on && env[name]){
    fade(env[name].g.gain, 0.0, 400);
    setTimeout(()=>{ try{env[name].src.stop();env[name].lfo.stop();}catch(e){}; env[name]=null; }, 450);
  }
}

// ===== å‘¼å¸å¼•å¯¼ï¼ˆ4-4-6ï¼‰ =====
let timer=null, secs=0, playing=false;
const ring = document.getElementById('ring'), timerEl = document.getElementById('timer');
function tick(){
  secs++; timerEl.textContent = new Date(secs*1000).toISOString().substr(14,5);
  const cycle = secs%14; // 4-4-6
  if(cycle===0||cycle===4||cycle===8){ ring.classList.add('big'); fade(toneGain.gain, 0.16, 500); }
  if(cycle===8){ /*åœé¡¿*/ fade(toneGain.gain, 0.06, 400); }
  if(cycle>8){ ring.classList.remove('big'); fade(toneGain.gain, 0.10, 500); }
}
function start(){
  ensureAC(); AC.resume();
  playing=true; setFreq(document.getElementById('hz').value);
  fade(toneGain.gain, 0.12, 500);
  if(!timer) timer=setInterval(tick,1000);
}
function pause(){ playing=false; fade(toneGain.gain, 0.0, 300); if(timer){clearInterval(timer); timer=null;} }
function reset(){ pause(); secs=0; timerEl.textContent='00:00'; ring.classList.remove('big'); }

document.getElementById('startBtn').onclick = start;
document.getElementById('pauseBtn').onclick = pause;
document.getElementById('resetBtn').onclick = reset;
document.getElementById('hz').addEventListener('change', e=> setFreq(e.target.value));
document.getElementById('pink').addEventListener('change', e=>{ ensureAC(); fade(noiseGain.gain, e.target.checked?0.08:0.0, 500); });
document.getElementById('envRain').addEventListener('change', e=> envOn('rain', e.target.checked));
document.getElementById('envForest').addEventListener('change', e=> envOn('forest', e.target.checked));
document.getElementById('envOcean').addEventListener('change', e=> envOn('ocean', e.target.checked));

// è¯­è¨€æŒ‰é’®æ–‡æ¡ˆ
window.addEventListener('du:lang', ()=>{ document.getElementById('langBtn').textContent = (DUi18n.get()==='zh'?'ğŸŒ è‹±æ–‡':'ğŸŒ Chinese'); });
;(function(w,d){
  // æ”¹è¿™é‡Œå³å¯å…¨ç«™åˆ‡æ¢æ”¯ä»˜é“¾æ¥
  const CONF = {
    monthly: 'https://dodva-noise-gumx.vercel.app/api/checkout?plan=monthly',
    yearly:  'https://dodva-noise-gumx.vercel.app/api/checkout?plan=yearly',
    backTo:  'index.html#subscribe' // æ”¯æŒä»å­é¡µè·³å›é¦–é¡µè®¢é˜…åŒº
  };

  let inited=false, host=null;
  function init(){
    if(inited) return; inited=true;
    host = d.createElement('div'); host.style.cssText='position:fixed;inset:0;display:none;z-index:99999;background:rgba(0,0,0,.65);backdrop-filter:blur(6px)';
    host.innerHTML = `
      <div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(92vw,540px);background:#0b0f1a;border:1px solid #2a2f48;border-radius:16px;padding:18px;box-shadow:0 22px 60px rgba(0,0,0,.55)">
        <h3 style="margin:0 0 8px">ğŸ’ Dodva Pro</h3>
        <p style="margin:0 0 12px;color:#b8bed1;font-size:14px">AI é™ªä¼´ Â· ç™½å™ªéŸ³å¼•æ“ Â· å†¥æƒ³é¢‘é“ Â· ç©å…·æŸœæ‰©å±•</p >
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="du-btn" href=" " style="flex:1;min-width:180px;text-align:center;border:1px solid #3b3f59;border-radius:10px;padding:10px 12px;background:#12121b;color:#eaf2ff;text-decoration:none">ğŸ’  $9.9 / æœˆ</a >
          <a class="du-btn" href="${CONF.yearly}"  style="flex:1;min-width:180px;text-align:center;border:1px solid #94a3b8;border-radius:10px;padding:10px 12px;background:#e2e8f0;color:#0b1220;text-decoration:none;font-weight:700">ğŸŒŒ $79 / å¹´</a >
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <a href="${CONF.backTo}" style="color:#93c5fd;text-decoration:none">â‡  å›åˆ°è®¢é˜…è¯´æ˜</a >
          <button id="duPayClose" style="border:1px solid #3b3f59;border-radius:10px;background:transparent;color:#eaf2ff;padding:6px 10px;cursor:pointer">å…³é—­</button>
        </div>
      </div>`;
    d.body.appendChild(host);
    host.addEventListener('click', e=>{ if(e.target===host) close(); });
    d.getElementById('duPayClose').addEventListener('click', close);
  }
  function open(plan){
    init();
    if(typeof plan==='string' && CONF[plan]){
      location.href = CONF[plan]; return;
    }
    host.style.display='block';
  }
  function close(){ host.style.display='none'; }
  function set(k,v){ CONF[k]=v; }
  w.duPay = { open, modal: open, close, set, conf: CONF };
})(window, document);

</script>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva Â· å†¥æƒ³ Meditationï¼ˆç²‰å™ª + 528/963Hzï¼‰</title>
<meta name="theme-color" content="#0b0f1a">
<style>
  :root{
    --bg:#0b0f1a; --fg:#eaf2ff; --muted:#a3b4d8; --line:rgba(147,197,253,.18);
    --pill:linear-gradient(135deg,#a5b4fc,#67e8f9,#f0abfc); --grad:linear-gradient(135deg,#f0abfc,#fb7185,#60a5fa);
    --glow:rgba(236,72,153,.22);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);
       font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans SC",sans-serif; overflow-x:hidden}

  /* ç»ç’ƒå¯¼èˆª */
  header{position:sticky;top:0;display:flex;gap:10px;align-items:center;
    padding:10px 16px;background:linear-gradient(180deg,rgba(10,16,34,.55),rgba(10,16,34,.35));
    border-bottom:1px solid var(--line);backdrop-filter:blur(10px); z-index:30}
  header a{color:#cde3ff;text-decoration:none;border:1px solid var(--line);
    padding:8px 12px;border-radius:999px}

  /* èƒŒæ™¯åŠ¨ç”»ï¼ˆæŸ”å’Œæ˜Ÿäº‘ + æ˜Ÿç‚¹ï¼‰ */
  .bg{
    position:fixed; inset:0; z-index:-2;
    background:
      radial-gradient(1200px 700px at 80% -10%, rgba(236,72,153,.10), transparent 60%),
      radial-gradient(1000px 600px at 15% 110%, rgba(99,102,241,.10), transparent 60%),
      #0b0f1a;
    animation:bgshift 18s ease-in-out infinite alternate;
  }
  @keyframes bgshift{
    from{ filter:hue-rotate(0deg) brightness(1); }
    to  { filter:hue-rotate(12deg) brightness(1.05); }
  }
  .stars{
    position:fixed; inset:0; z-index:-1; pointer-events:none;
    background-image:
      radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(1.5px 1.5px at 60% 70%, rgba(255,255,255,.25), transparent 60%),
      radial-gradient(1.8px 1.8px at 80% 40%, rgba(255,255,255,.28), transparent 60%),
      radial-gradient(1.2px 1.2px at 35% 80%, rgba(255,255,255,.22), transparent 60%);
    animation: twinkle 6s ease-in-out infinite alternate;
    filter: blur(.2px);
  }
  @keyframes twinkle{
    from{ opacity:.6; transform:translateY(0) }
    to  { opacity:.9; transform:translateY(-3px) }
  }

  /* é¡¶éƒ¨æš–å¿ƒæ¡ï¼ˆMomoLines æŒ‚è½½ç‚¹ï¼‰ */
  #momo-line{
    position: sticky; top: 0; z-index: 25;
    margin: 0; padding: 10px 14px;
    background: linear-gradient(180deg, rgba(10,16,34,.65), rgba(10,16,34,.35));
    border-bottom: 1px solid rgba(147,197,253,.18);
    color: #eaf2ff; font-size: 15px;
  }

  .wrap{max-width:980px;margin:14px auto 80px;padding:0 16px}

  h1{margin:.2em 0 .3em}
  p.sub{opacity:.9;color:#d9e6ff;margin:.2em 0 1.0em}

  /* å¡ç‰‡/é¢æ¿ */
  .panel{border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;
    background:linear-gradient(180deg,rgba(10,16,34,.55),rgba(10,16,34,.35));
    box-shadow:0 10px 28px rgba(7,11,22,.35)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{background:rgba(147,197,253,.08);border:1px solid var(--line);color:var(--fg);
    padding:10px 14px;border-radius:12px;cursor:pointer}
  .pill{background:var(--pill);color:#051019;font-weight:800;border:none;cursor:pointer;border-radius:12px;padding:10px 14px}
  .small{font-size:12px;color:var(--muted)}
  .hint{font-size:13px;color:var(--muted)}

  /* breathe guide */
  .breathe{
    display:flex;align-items:center;gap:14px;flex-wrap:wrap
  }
  .orb{
    width:110px;height:110px;border-radius:999px;
    background:radial-gradient(circle at 35% 35%,rgba(255,255,255,.35),rgba(236,72,153,.12));
    border:1px solid rgba(236,72,153,.28); box-shadow:0 0 24px var(--glow), inset 0 0 16px rgba(236,72,153,.16);
    transition:transform 2s ease, box-shadow 2s ease;
  }
  .orb.expand{ transform:scale(1.12); box-shadow:0 0 36px var(--glow), inset 0 0 22px rgba(236,72,153,.20); }
  .step{min-width:110px}
  .kbd{padding:2px 6px;border:1px solid var(--line);border-radius:6px;background:rgba(147,197,253,.08)}

  /* ä»˜è´¹é¢‘ç‡åŒºï¼ˆPro æ‰è§£é”ï¼‰ */
  .freq-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:12px}
  .card{border:1px solid var(--line);border-radius:12px;padding:12px;background:rgba(147,197,253,.04)}
  .card h4{margin:.2em 0 .4em}
  .toggle{display:flex;gap:10px;align-items:center;margin-top:8px}

  /* è§£é”é—¨ */
  [data-gated]{display:none;}
  .visible{display:block !important;}

  /* è¯­éŸ³çŠ¶æ€ */
  .mic{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--line)}
  .dot{width:8px;height:8px;border-radius:999px;background:#64748b}
  .dot.on{background:#22d3ee; box-shadow:0 0 8px #22d3ee}
</style>
</head>
<body>

<div class="bg"></div>
<div class="stars"></div>

<!-- é¡¶éƒ¨æš–å¿ƒå¥ï¼ˆMomoLinesï¼‰ -->
<div id="momo-line">åŠ è½½ä¸­â€¦</div>

<div class="wrap">
  <h1>ğŸ§˜ å†¥æƒ³ Â· ç²‰å™ª + é¢‘ç‡å…±æŒ¯</h1>
  <p class="sub">æ ¸å¿ƒä¸ºç²‰å™ªï¼ˆç²‰çº¢å™ªéŸ³ï¼ŒæŸ”å’ŒåŒ…è£¹æ„Ÿï¼‰ã€‚å¯å åŠ  528Hzï¼ˆä¿®å¤ï¼‰/ 963Hzï¼ˆæ¾æœä½“ï¼‰é¢‘ç‡ä¸å‘¼å¸å¼•å¯¼ã€‚é¦–æ¬¡éœ€ç‚¹å‡»æŒ‰é’®æˆæƒéŸ³é¢‘æ’­æ”¾ã€‚</p>

  <!-- è®¢é˜… CTAï¼ˆæœªè§£é”æ—¶æ˜¾ç¤ºï¼‰ -->
  <section id="dv-cta" class="panel">
    <h3>è§£é” Dodva Noise Â· Pro</h3>
    <p class="hint">Pro è§£é”åå¯ä½¿ç”¨ <b>528Hz</b> / <b>963Hz</b> é¢‘ç‡ã€è‡ªåŠ¨å®šæ—¶æ·¡å‡ºã€è¯­éŸ³æŒ‡ä»¤ç­‰åŠŸèƒ½ã€‚</p>
    <div class="row">
      <a class="pill" href="https://dodva-noise-gumx.vercel.app/api/checkout?plan=monthly">ğŸ’ $9.9 / æœˆ</a>
      <a class="btn"  href="https://dodva-noise-gumx.vercel.app/api/checkout?plan=yearly">ğŸŒŒ $79 / å¹´</a>
      <span class="small">è°ƒè¯•ï¼šåœ¨åœ°å€æ åŠ  <code>?unlock=1</code> å¯æœ¬åœ°è§£é”æµ‹è¯•</span>
    </div>
  </section>

  <!-- ä¸»æ§ï¼ˆæ‰€æœ‰äººå¯ç”¨ï¼‰ -->
  <section class="panel">
    <h3>ğŸ›ï¸ ç²‰å™ªä¸»æ§</h3>
    <div class="row">
      <button id="play" class="pill">â–¶ï¸ æ’­æ”¾</button>
      <button id="pause" class="btn">â¸ æš‚åœ</button>
      <label>éŸ³é‡
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.55"/>
      </label>
      <label>å®šæ—¶æ·¡å‡º
        <select id="timer">
          <option value="0">å…³é—­</option>
          <option value="15">15 åˆ†é’Ÿ</option>
          <option value="30" selected>30 åˆ†é’Ÿ</option>
          <option value="60">60 åˆ†é’Ÿ</option>
        </select>
      </label>
      <button id="startTimer" class="btn">â³ å¼€å§‹å®šæ—¶</button>
      <span id="left" class="hint"></span>
      <span class="mic" id="mic"><span class="dot" id="dot"></span>è¯­éŸ³</span>
    </div>
    <div id="desc" class="hint" style="margin-top:6px">å½“å‰ï¼šç²‰å™ª Â· æŸ”å’ŒåŒ…è£¹æ„Ÿï¼Œå»ºè®®éŸ³é‡ 50ï½60%ã€‚</div>
  </section>

  <!-- é¢‘ç‡åŒºï¼ˆPro è§£é”ï¼‰ -->
  <section id="freq-zone" class="panel" data-gated>
    <h3>ğŸ’« é¢‘ç‡å…±æŒ¯ï¼ˆProï¼‰</h3>
    <div class="freq-grid">
      <div class="card">
        <h4>528Hz Â· DNA ä¿®å¤</h4>
        <p class="hint">æ¸©æš–ã€å®‰å¿ƒï¼ŒåŠ©æ”¾æ¾ä¸è‡ªæˆ‘ä¿®å¤ã€‚</p>
        <div class="toggle">
          <button id="hz528" class="btn">å¯ç”¨ 528Hz</button>
          <label>ç”µå¹³ <input id="gain528" type="range" min="0" max="1" step="0.01" value="0.22"></label>
        </div>
      </div>
      <div class="card">
        <h4>963Hz Â· æ¾æœä½“</h4>
        <p class="hint">æ¸…äº®ã€é€šé€ï¼ŒåŠ©å†¥æƒ³ä¸å†…åœ¨è§†è§‰ã€‚</p>
        <div class="toggle">
          <button id="hz963" class="btn">å¯ç”¨ 963Hz</button>
          <label>ç”µå¹³ <input id="gain963" type="range" min="0" max="1" step="0.01" value="0.18"></label>
        </div>
      </div>
    </div>
  </section>

  <!-- å‘¼å¸å¼•å¯¼ï¼ˆæ‰€æœ‰äººå¯ç”¨ï¼‰ -->
  <section class="panel">
    <h3>ğŸ« å‘¼å¸å¼•å¯¼</h3>
    <div class="breathe">
      <div class="orb" id="orb" aria-hidden="true"></div>
      <div class="step">
        <div id="guide" style="font-weight:700">å¸æ°” 4 æ‹</div>
        <div class="small">èŠ‚å¥ï¼š4-1-6-1ï¼ˆå¸-åœ-å‘¼-åœï¼‰</div>
      </div>
      <div class="row">
        <button id="breathStart" class="btn">å¼€å§‹å¼•å¯¼</button>
        <button id="breathStop" class="btn">åœæ­¢å¼•å¯¼</button>
      </div>
    </div>
  </section>

</div>

<!-- ä¾èµ–ï¼šMomoLinesï¼ˆç»å¯¹è·¯å¾„ï¼Œç«™ç‚¹æ ¹ï¼‰ -->
<script src="/assets/js/momo-lines.js"></script>
<script>
  // é¡¶éƒ¨æš–å¿ƒå¥ï¼ˆå«å†¥æƒ³æç¤ºï¼‰
  try{
    MomoLines.mount({
      mount:'#momo-line', interval:6500, random:true,
      lines:[
        { text:'è®©ç²‰è‰²çš„å…‰åƒäº‘ä¸€æ ·ï¼Œè½»è½»æŠŠä½ åŒ…ä½ã€‚' },
        { text:'å¸å››åœä¸€ã€å‘¼å…­åœä¸€ã€‚èƒ¸å£ä¼šæ…¢æ…¢å˜æš–ã€‚' },
        { text:'å¬åˆ° 963Hz æ—¶ï¼Œæ³¨æ„åŠ›æ”¾åœ¨çœ‰å¿ƒä¹‹é—´ã€‚' },
        { text:'å¦‚æœæƒ…ç»ªä¸Šæ¥ï¼Œä¸è¦æŠ—æ‹’ï¼Œè®©å®ƒåƒé›¾ä¸€æ ·ç©¿è¿‡ä½ ã€‚' },
        { text:'ä½ è¢«çˆ±ç€ã€‚ä½ å°±æ˜¯çˆ±æœ¬èº«ã€‚' }
      ]
    });
  }catch(e){ document.getElementById('momo-line').textContent='æ„¿å¹³é™ä¸çˆ±ä¸ä½ åŒåœ¨ã€‚'; }
</script>

<!-- ===== è§£é”é€»è¾‘ï¼ˆæœ¬åœ°æµ‹è¯• ?unlock=1ï¼›æ­£å¼ä¾èµ–æˆåŠŸé¡µè¿½åŠ  ?unlocked=1ï¼‰ ===== -->
<script>
(function gate(){
  const url = new URL(location.href);
  if (url.searchParams.get('unlock') === '1') {
    localStorage.setItem('dodvaPro','true');
    url.searchParams.delete('unlock');
    history.replaceState(null,'',url.toString());
  }
  if (url.searchParams.get('unlocked') === '1') {
    localStorage.setItem('dodvaPro','true');
  }
  const isPro = localStorage.getItem('dodvaPro') === 'true';
  const gated = document.querySelectorAll('[data-gated]');
  const cta = document.getElementById('dv-cta');
  if (isPro){ gated.forEach(el=>el.classList.add('visible')); cta.style.display='none'; }
  else      { gated.forEach(el=>el.classList.remove('visible')); cta.style.display='block'; }
})();
</script>

<!-- ===== Web Audioï¼šç²‰å™ª + é¢‘ç‡ + å®šæ—¶æ·¡å‡º ===== -->
<script>
(()=>{
  let ctx, master, pinkNode, pinkFilterChain=[];
  let osc528=null, gain528=null, osc963=null, gain963=null;
  let fadeTimer=null, tickTimer=null, endAt=0;

  const $ = s=>document.querySelector(s);
  const playBtn=$('#play'), pauseBtn=$('#pause'), volEl=$('#vol');
  const timerSel=$('#timer'), startTimerBtn=$('#startTimer'), leftEl=$('#left');
  const desc=$('#desc');

  async function ensureCtx(){
    if (ctx) return;
    ctx = new (window.AudioContext||window.webkitAudioContext)();
    master = ctx.createGain();
    master.gain.value = parseFloat(volEl.value||'0.55');
    master.connect(ctx.destination);
    buildPink();
    buildFreqNodes(); // é¢„å»ºï¼ˆé»˜è®¤é™éŸ³ï¼‰
  }

  // Pink noise: ç™½å™ªé€šè¿‡å¤šæ®µä½é€š/ææ¶å¡‘å½¢ â‰ˆ ç²‰å™ªè¿‘ä¼¼
  function buildPink(){
    stopPink();
    const src = ctx.createBufferSource();
    const len = 2*ctx.sampleRate;
    const buf = ctx.createBuffer(1, len, ctx.sampleRate);
    const data = buf.getChannelData(0);
    for(let i=0;i<len;i++){ data[i] = Math.random()*2 - 1; }
    src.buffer = buf; src.loop = true;

    const lp1 = ctx.createBiquadFilter(); lp1.type='lowpass';  lp1.frequency.value=1800; lp1.Q.value=.7;
    const peq = ctx.createBiquadFilter(); peq.type='peaking';  peq.frequency.value=300;  peq.Q.value=.9; peq.gain.value=3;
    const hs  = ctx.createBiquadFilter(); hs.type='highshelf'; hs.frequency.value=3000; hs.gain.value=-4;

    src.connect(lp1); lp1.connect(peq); peq.connect(hs); hs.connect(master);
    pinkNode = src; pinkFilterChain = [lp1, peq, hs];
  }

  function startPink(){ try{ pinkNode && pinkNode.start(0); }catch{} }
  function stopPink(){ try{ pinkNode && pinkNode.stop(); }catch{} pinkNode=null; }

  // é¢‘ç‡æŒ¯è¡å™¨ï¼ˆæ­£å¼¦ï¼‰ï¼Œé»˜è®¤ä¸è¿æ¥ master
  function buildFreqNodes(){
    // 528
    gain528 = ctx.createGain(); gain528.gain.value = 0.0;
    osc528 = ctx.createOscillator(); osc528.type='sine'; osc528.frequency.value=528;
    osc528.connect(gain528).connect(master); osc528.start();

    // 963
    gain963 = ctx.createGain(); gain963.gain.value = 0.0;
    osc963 = ctx.createOscillator(); osc963.type='sine'; osc963.frequency.value=963;
    osc963.connect(gain963).connect(master); osc963.start();
  }

  // æ’­æ”¾/æš‚åœ/éŸ³é‡
  playBtn.addEventListener('click', async ()=>{
    await ensureCtx();
    if (ctx.state==='suspended') await ctx.resume();
    buildPink(); startPink();
  });
  pauseBtn.addEventListener('click', ()=>{ stopPink(); });
  volEl.addEventListener('input', ()=>{
    if (!master||!ctx) return;
    master.gain.setTargetAtTime(parseFloat(volEl.value||'0.55'), ctx.currentTime, 0.01);
  });

  // å®šæ—¶æ·¡å‡º
  startTimerBtn.addEventListener('click', ()=>{
    if (!ctx||!master) return;
    clearTimeout(fadeTimer); clearInterval(tickTimer);
    const mins = parseInt(timerSel.value,10);
    if (!mins){ leftEl.textContent=''; return; }
    const now = Date.now(); endAt = now + mins*60*1000;
    leftEl.textContent = `å®šæ—¶ä¸­ï¼š${mins}:00`;
    tickTimer = setInterval(()=>{
      const left = Math.max(0, endAt - Date.now());
      const m = Math.floor(left/60000), s = Math.floor((left%60000)/1000);
      leftEl.textContent = `å®šæ—¶ä¸­ï¼š${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      if (left<=0) clearInterval(tickTimer);
    }, 500);

    const fadeMs = 16000;
    fadeTimer = setTimeout(()=>{
      const t0 = ctx.currentTime, t1 = t0 + fadeMs/1000;
      master.gain.cancelScheduledValues(t0);
      master.gain.setValueAtTime(master.gain.value, t0);
      master.gain.linearRampToValueAtTime(0.0001, t1);
      setTimeout(()=>{ stopPink(); master.gain.value=parseFloat(volEl.value||'0.55'); leftEl.textContent='å·²æ·¡å‡ºç»“æŸ'; }, fadeMs+250);
    }, Math.max(0, mins*60*1000 - fadeMs));
  });

  // é¢‘ç‡æ§åˆ¶ï¼ˆProï¼‰
  const isPro = localStorage.getItem('dodvaPro')==='true';
  const hz528Btn = document.getElementById('hz528');
  const hz963Btn = document.getElementById('hz963');
  const gain528El = document.getElementById('gain528');
  const gain963El = document.getElementById('gain963');

  function toggleSine(which){
    if (!ctx) return;
    if (which===528){
      const on = (gain528.gain.value > 0.0001);
      const target = on ? 0.0 : parseFloat(gain528El.value||'0.22');
      gain528.gain.setTargetAtTime(target, ctx.currentTime, 0.03);
      hz528Btn.textContent = target>0? 'å…³é—­ 528Hz' : 'å¯ç”¨ 528Hz';
    } else {
      const on = (gain963.gain.value > 0.0001);
      const target = on ? 0.0 : parseFloat(gain963El.value||'0.18');
      gain963.gain.setTargetAtTime(target, ctx.currentTime, 0.03);
      hz963Btn.textContent = target>0? 'å…³é—­ 963Hz' : 'å¯ç”¨ 963Hz';
    }
  }

  if (hz528Btn && isPro){
    hz528Btn.addEventListener('click', async ()=>{ await ensureCtx(); toggleSine(528); });
    gain528El.addEventListener('input', ()=>{ if(ctx&&gain528) gain528.gain.setTargetAtTime(parseFloat(gain528El.value||'0.22'), ctx.currentTime, 0.02); });
  }
  if (hz963Btn && isPro){
    hz963Btn.addEventListener('click', async ()=>{ await ensureCtx(); toggleSine(963); });
    gain963El.addEventListener('input', ()=>{ if(ctx&&gain963) gain963.gain.setTargetAtTime(parseFloat(gain963El.value||'0.18'), ctx.currentTime, 0.02); });
  }

  if (!isPro){
    // æœªè§£é”æ—¶ç¦ç”¨æŒ‰é’®
    hz528Btn && (hz528Btn.disabled = true);
    hz963Btn && (hz963Btn.disabled = true);
  }

  // å‘¼å¸å¼•å¯¼
  const orb = document.getElementById('orb');
  const guide = document.getElementById('guide');
  let breatheTimer=null, phase=0;
  function setGuide(txt, expand){ guide.textContent=txt; orb.classList.toggle('expand', !!expand); }
  function tickBreathe(){
    phase = (phase+1)%12; // 12 ä¸ªåŠæ‹ï¼šå¸4ã€åœ1ã€å‘¼6ã€åœ1ï¼ˆæˆ‘ä»¬æŒ‰ 12*0.5s = 6s ä¸€ä¸ªå¾ªç¯ï¼Œå¯è°ƒï¼‰
    // ç”¨è¾ƒæ…¢çš„èŠ‚å¥ï¼šæ¯æ­¥ 1 ç§’ï¼Œæ›´ç¨³
  }
  function startBreathe(){
    stopBreathe(); phase=0;
    setGuide('å¸æ°” 4 æ‹', true);
    let step=0;
    breatheTimer = setInterval(()=>{
      step=(step+1)%12;
      if (step===0){ setGuide('å¸æ°” 4 æ‹', true); }
      if (step===4){ setGuide('åœ 1 æ‹', true); }
      if (step===5){ setGuide('å‘¼æ°” 6 æ‹', false); }
      if (step===11){ setGuide('åœ 1 æ‹', false); }
    }, 1000);
  }
  function stopBreathe(){ clearInterval(breatheTimer); breatheTimer=null; setGuide('å¸æ°” 4 æ‹', true); }

  document.getElementById('breathStart').addEventListener('click', startBreathe);
  document.getElementById('breathStop').addEventListener('click', stopBreathe);

  // åˆå§‹æè¿°
  desc.textContent = 'å½“å‰ï¼šç²‰å™ª Â· æŸ”å’ŒåŒ…è£¹æ„Ÿï¼Œå»ºè®®éŸ³é‡ 50ï½60%ã€‚';
})();
</script>

<!-- ===== è¯­éŸ³æŒ‡ä»¤ï¼ˆå¯é€‰ï¼ŒChrome/Safari æ”¯æŒï¼‰ ===== -->
<script>
(()=>{
  const mic=document.getElementById('mic'), dot=document.getElementById('dot');
  if (!('webkitSpeechRecognition' in window)) return; // ç®€æ˜“å…¼å®¹å¤„ç†
  const R = new webkitSpeechRecognition();
  R.lang='zh-CN'; R.continuous=true; R.interimResults=false;

  mic.addEventListener('click', ()=>{
    if (dot.classList.contains('on')){ R.stop(); dot.classList.remove('on'); }
    else{ R.start(); dot.classList.add('on'); }
  });

  function fire(id){ document.getElementById(id)?.click(); }
  function setGain(id, v){ const el=document.getElementById(id); if(!el) return; el.value=String(v); el.dispatchEvent(new Event('input')); }

  R.onresult = (e)=>{
    const text = Array.from(e.results).slice(-1)[0][0].transcript.trim();
    // æ§åˆ¶ç²‰å™ª
    if (/æ’­æ”¾|å¼€å§‹/.test(text)) fire('play');
    if (/æš‚åœ|åœæ­¢/.test(text)) fire('pause');
    if (/(å¤§|åŠ ).*éŸ³é‡|éŸ³é‡å¤§/.test(text)) {
      const v=Math.min(1, (parseFloat(document.getElementById('vol').value)||.55)+.1); setGain('vol', v);
    }
    if (/(å°|å‡).*éŸ³é‡|éŸ³é‡å°/.test(text)) {
      const v=Math.max(0, (parseFloat(document.getElementById('vol').value)||.55)-.1); setGain('vol', v);
    }
    // é¢‘ç‡ï¼ˆéœ€ Pro è§£é”åæ‰æœ‰æ•ˆï¼‰
    if (/äº”äºŒå…«|äº”ç™¾äºŒåå…«|äº”äºŒå…«èµ«å…¹|ä¿®å¤/.test(text)) document.getElementById('hz528')?.click();
    if (/ä¹å…­ä¸‰|ä¹ç™¾å…­åä¸‰|ä¹å…­ä¸‰èµ«å…¹|æ¾æœä½“/.test(text)) document.getElementById('hz963')?.click();

    // å‘¼å¸å¼•å¯¼
    if (/å¼€å§‹å‘¼å¸|å‘¼å¸å¼•å¯¼/.test(text)) document.getElementById('breathStart')?.click();
    if (/åœæ­¢å‘¼å¸/.test(text)) document.getElementById('breathStop')?.click();
  };
})();
</script>

<noscript>
  <div class="wrap"><section class="panel"><b>éœ€è¦å¯ç”¨ JavaScript</b> æ‰èƒ½ä½¿ç”¨å†¥æƒ³åŠŸèƒ½ã€‚</section></div>
</noscript>

</body>
</html>

</body>
</html>