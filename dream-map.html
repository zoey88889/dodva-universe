<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ¢¦å¢ƒæ˜Ÿ Â· Dodva Universe</title>
<link rel="stylesheet" href="style.css">
<style>
  .dream-form {display:grid;gap:12px}
  .dream-list {display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:16px}
  .dream-card {border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px;background:rgba(255,255,255,.04)}
  .dream-card img{max-width:100%;border-radius:10px;border:1px solid rgba(255,255,255,.1);margin-top:8px}
  .tag{font-size:.85rem;color:var(--muted)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.25);color:var(--ink)}
  button{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:var(--ink);cursor:pointer}
  button:hover{background:rgba(255,255,255,.14)}
</style>
</head>
<body>
<header>
  <div>ğŸŒ™ æ¢¦å¢ƒæ˜Ÿ</div>
  <nav>
    <a href="index.html">é¦–é¡µ</a>
    <a href="dream-map.html">Dream Map</a>
    <a href="gallery.html">Gallery</a>
    <a href="upload.html">ä¸Šä¼ æ¢¦å¢ƒ</a>
  </nav>
</header>

<div class="container">
  <div class="card">
    <h2>æäº¤ä½ çš„æ¢¦å¢ƒ</h2>
    <p class="notice">æœ¬é¡µä¸ºæœ¬åœ°åŸå‹ï¼šæ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨ <b>localStorage</b>ã€‚æ¢è®¾å¤‡/æ¸…ç¼“å­˜ä¼šä¸¢å¤±ï¼›ç¨åå¯æ¥ Netlify Forms / Supabaseã€‚</p>

    <form id="dreamForm" class="dream-form">
      <div class="row">
        <div><label>æ˜µç§°
          <input name="nickname" placeholder="ä½ çš„åå­—" required></label></div>
        <div><label>æ ‡é¢˜
          <input name="title" placeholder="æ¢¦å¢ƒæ ‡é¢˜" required></label></div>
      </div>

      <label>æè¿°
        <textarea name="description" rows="4" placeholder="å†™ä¸‹ç”»é¢ã€æƒ…ç»ªã€å¯ç¤ºâ€¦" required></textarea></label>

      <div class="row">
        <div><label>çº¬åº¦ï¼ˆé€‰å¡«ï¼‰
          <input name="lat" type="number" step="any" placeholder="12.34"></label></div>
        <div><label>ç»åº¦ï¼ˆé€‰å¡«ï¼‰
          <input name="lng" type="number" step="any" placeholder="56.78"></label></div>
      </div>

      <label>å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼Œé€‰å¡«ï¼‰
        <input name="tags" placeholder="é“¶ç™½é±¼, æ¼©æ¶¡, åº¦å‡å²›"></label>

      <label>å›¾ç‰‡ï¼ˆé€‰å¡«ï¼‰
        <input id="imageInput" type="file" accept="image/*"></label>

      <button type="submit">âœ¨ å‘å¸ƒæ¢¦å¢ƒ</button>
      <button type="button" id="clearBtn" title="ä»…æ¸…é™¤æœ¬åœ°ç¼“å­˜">æ¸…ç©ºæœ¬åœ°æ•°æ®</button>
    </form>
  </div>

  <div class="card">
    <h2>æœ€æ–°æ¢¦å¢ƒ</h2>
    <div id="list" class="dream-list"></div>
  </div>
</div>

<footer>Â© 2025 Dodva Universe</footer>

<script>
  const KEY = 'dodva_dreams_v1';
  const $form = document.getElementById('dreamForm');
  const $list = document.getElementById('list');
  const $clear = document.getElementById('clearBtn');
  const $img = document.getElementById('imageInput');

  // è½½å…¥
  let dreams = [];
  try { dreams = JSON.parse(localStorage.getItem(KEY)) || []; } catch(e){ dreams = []; }
  render();

  // æäº¤
  $form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const fd = new FormData($form);
    const d = {
      id: Date.now(),
      nickname: (fd.get('nickname')||'').trim(),
      title: (fd.get('title')||'').trim(),
      description: (fd.get('description')||'').trim(),
      tags: (fd.get('tags')||'').split(',').map(s=>s.trim()).filter(Boolean),
      lat: parseFloat(fd.get('lat')), lng: parseFloat(fd.get('lng')),
      image: null,
      createdAt: new Date().toISOString()
    };

    // è¯»å–å›¾ç‰‡ä¸º dataURLï¼ˆæœ¬åœ°åŸå‹å­˜å‚¨ï¼‰
    if ($img.files && $img.files[0]) {
      d.image = await fileToDataURL($img.files[0]);
    }

    dreams.unshift(d);
    localStorage.setItem(KEY, JSON.stringify(dreams));
    $form.reset(); $img.value = '';
    render();
  });

  // æ¸…ç©ºæœ¬åœ°ç¼“å­˜
  $clear.addEventListener('click', ()=>{
    if (confirm('ç¡®å®šæ¸…ç©ºæœ¬åœ°ä¿å­˜çš„æ¢¦å¢ƒå—ï¼Ÿï¼ˆä»…å½±å“æœ¬è®¾å¤‡æµè§ˆå™¨ï¼‰')) {
      localStorage.removeItem(KEY);
      dreams = [];
      render();
    }
  });

  function render(){
    if (!dreams.length) { $list.innerHTML = '<p class="notice">æš‚æ— æ¢¦å¢ƒï¼Œå¿«æ¥å‘å¸ƒä½ çš„ç¬¬ä¸€æ¡å§ï½</p>'; return; }
    $list.innerHTML = dreams.map(d => `
      <div class="dream-card">
        <div class="tag">${new Date(d.createdAt).toLocaleString()}</div>
        <h3>${escapeHTML(d.title||'æœªå‘½åæ¢¦å¢ƒ')}</h3>
        <div class="tag">by ${escapeHTML(d.nickname||'åŒ¿å')} Â· ${(d.tags||[]).join(' Â· ')}</div>
        ${d.image ? `<img src="${d.image}" alt="">` : ''}
        <p>${escapeHTML(d.description||'')}</p>
        ${isFinite(d.lat) && isFinite(d.lng) ? `<div class="tag">åæ ‡ï¼š${d.lat}, ${d.lng}</div>` : ''}
      </div>
    `).join('');
  }

  function fileToDataURL(file){
    return new Promise((resolve,reject)=>{
      const r = new FileReader();
      r.onload = ()=>resolve(r.result);
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }
  function escapeHTML(s){ return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
</script>
</body>
</html>
