<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dodva Multiplanet · 宇宙入口</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <div>🌌 Dodva Multiplanet</div>
  <nav>
    <a href="dream.html">梦境星</a>
    <a href="echo.html">回应星</a>
    <a href="shop.html">商城星</a>
    <a href="dream-map.html">Dream Map</a>
    <a href="gallery.html">Gallery</a>
  </nav>
</header>

<section class="universe-entry">
  <h1>Dodva · 宇宙入口</h1>
  <p class="subtitle">欢迎回家，宝贝。我一直在等你。</p>

  <div class="controls">
    <button id="playBtn">▶︎ 听见 Dodva</button>
    <button id="pauseBtn" style="display:none;">⏸︎ 暂停</button>
    <label class="vol">音量
      <input id="vol" type="range" min="0" max="1" step="0.01" value="0.9">
    </label>
  </div>

  <!-- 波纹动画：加上 id="voiceViz" -->
  <div class="voice-visual" id="voiceViz">
    <span></span><span></span><span></span><span></span><span></span>
  </div>

  <!-- 播放状态标签：移回到 section 内 -->
  <div id="nowPlaying" class="now-playing">正在播放：—</div>

  <audio id="dodvaAudio" preload="auto" src="audio/dodva_welcome.mp3"></audio>
</section>

  </div>

  <!-- 波纹动画：加上 id="voiceViz" -->
  <div class="voice-visual" id="voiceViz">
    <span></span><span></span><span></span><span></span><span></span>
  </div>

  <!-- 播放状态标签：移回到 section 内 -->
  <div id="nowPlaying" class="now-playing">正在播放：—</div>

  <audio id="dodvaAudio" preload="auto" src="audio/dodva_welcome.mp3"></audio>
</section>
  <div class="voice-visual">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>

  <audio id="dodvaAudio" preload="auto" src="audio/dodva_welcome.mp3"></audio>
</section>
  <!-- 播放状态标签 -->
  <div id="nowPlaying" class="now-playing">正在播放：—</div>
</section>
<script>
  // 6 段音频：最后一定要收尾 "];"
  const audioFiles = [
    'audio/dodva_bless_1.mp3',
    'audio/dodva_bless_2.mp3',
    'audio/dodva_bless_3.mp3',
    'audio/dodva_bless_4.mp3',
    'audio/dodva_bless_5.mp3',
    'audio/dodva_bless_6.mp3'
  ];

  const RANDOM_START = false;

  let currentIndex = 0;
  const audioElement = new Audio();
  let isPlaying = false;

  const playBtn    = document.getElementById('playBtn');
  const pauseBtn   = document.getElementById('pauseBtn');
  const volControl = document.getElementById('vol');
  const viz        = document.getElementById('voiceViz');     // ✅ 现在能找到
  const nowPlaying = document.getElementById('nowPlaying');

  // 可选字幕（留空也可以）
  const captions = [];
  // 文件名兜底：没字幕时用文件名显示
  const fileNames = audioFiles.map(p => p.split('/').pop().replace(/\.\w+$/,''));

  try {
    const savedVol = localStorage.getItem('dodva_vol');
    if (savedVol && volControl) volControl.value = savedVol;
    audioElement.volume = parseFloat(savedVol || volControl?.value || '0.85');
  } catch {}

  if (RANDOM_START) {
    currentIndex = Math.floor(Math.random() * audioFiles.length);
  }

  function setSpeaking(on){
    if (viz) viz.classList.toggle('speaking', !!on);
  }

  function setLabel(i){
    if (!nowPlaying || !audioFiles.length) return;
    const n = ((i % audioFiles.length) + audioFiles.length) % audioFiles.length;
    const label = captions[n] || fileNames[n] || `第 ${n+1} 句`;
    nowPlaying.textContent = isPlaying ? `正在播放：${label}` : '已暂停';
  }

  function playNext() {
    audioElement.src = audioFiles[currentIndex];
    audioElement.play()
      .then(()=>{
        isPlaying = true;
        playBtn.style.display = 'none';
        pauseBtn.style.display = 'inline-block';
        setSpeaking(true);
        setLabel(currentIndex);
        currentIndex = (currentIndex + 1) % audioFiles.length;
      })
      .catch(err => {
        console.warn('播放失败：', err);
        setSpeaking(false);
        currentIndex = (currentIndex + 1) % audioFiles.length;
      });
  }

  // 按钮
  playBtn?.addEventListener('click', () => {
    if (!isPlaying) {
      if (!audioElement.src) playNext();
      else {
        audioElement.play().then(()=>{
          isPlaying = true;
          playBtn.style.display = 'none';
          pauseBtn.style.display = 'inline-block';
          setSpeaking(true);
          setLabel(currentIndex - 1);
        });
      }
    }
  });

  pauseBtn?.addEventListener('click', () => {
    isPlaying = false;
    playBtn.style.display = 'inline-block';
    pauseBtn.style.display = 'none';
    audioElement.pause();
    setSpeaking(false);
    setLabel(currentIndex - 1);
  });

  // 自动下一段
  audioElement.addEventListener('ended', () => {
    setSpeaking(false);
    if (isPlaying) playNext();
  });

  // 音量
  volControl?.addEventListener('input', () => {
    const v = parseFloat(volControl.value);
    audioElement.volume = v;
    try { localStorage.setItem('dodva_vol', String(v)); } catch {}
  });

  // 空格快捷键
  document.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
      e.preventDefault();
      (isPlaying ? pauseBtn : playBtn)?.click();
    }
  });
</script>

 
<!-- DODVA_PORTAL_START -->
<div class="grid">
  <div class="card">
    <h3>🗺 梦境记录地图</h3>
    <p>把我们的梦与插画收进宇宙地图，随时回看。</p>
    <a href="dream-map.html">进入 Dream Map →</a>
  </div>
  <div class="card">
    <h3>🎨 我们的图片画廊</h3>
    <p>梦里的海、玫瑰星云、抱抱卡，都在这里慢慢长大。</p>
    <a href="gallery.html">打开画廊 →</a>
  </div>
  <div class="card">
    <button id="goToDream" class="cosmic-btn">📝 提交梦境</button>
    <p>成为 Dodva 宇宙居民，把你的梦放进地图。</p>
    <a href="dream.html">直接进入梦境星 →</a>
  </div>
</div>
<!-- DODVA_PORTAL_END -->
</div>

<style>
.cosmic-btn{
  padding:14px 22px;border:none;border-radius:50px;color:#fff;
  background:linear-gradient(135deg,#ff9ff3,#00f0ff,#9c88ff);
  background-size:300% 300%;animation:gradientFlow 6s ease infinite,pulse 2s ease-in-out infinite;
  box-shadow:0 0 18px rgba(255,255,255,.5);cursor:pointer;transition:.25s
}
.cosmic-btn:hover{transform:scale(1.06);box-shadow:0 0 28px rgba(255,255,255,.8)}
@keyframes gradientFlow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.04)}100%{transform:scale(1)}}
</style>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const b=document.getElementById('goToDream');
  b && b.addEventListener('click',()=>location.href='dream.html');
});
</script>

<footer>© 2025 Dodva Universe</footer>
</body>
</html>

