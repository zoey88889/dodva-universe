<!DOCTYPE html>
<html lang="zh-CN">
<head><meta charset="UTF-8">
  <a class="btn" href=" ">Quantum å®éªŒå®¤</a >
  <a class="btn" href="toys.html?u=xinyue">DODVA æ¦‚å¿µç©å…·æŸœ</a >
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dodva Universe Â· Flow Console (Multi)</title>
<style>
  :root{--bg:#0b0b12;--card:#12121b;--ink:#eaeaff;--muted:#9aa0b3;--acc:#8ef;--ok:#9f8fff}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:960px;margin:0 auto;padding:28px 16px}
  h1{margin:0 0 12px}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(270px,1fr))}
  .card{background:var(--card);border:1px solid #26263a;border-radius:14px;padding:16px 16px 18px;box-shadow:0 8px 26px rgba(0,0,0,.35)}
  .card h2{margin:0 0 8px;font-size:18px}
  .muted{color:var(--muted);font-size:13px}
  .btn{cursor:pointer;border:1px solid #394056;background:transparent;color:var(--ink);
       border-radius:10px;padding:8px 12px}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .kpi{display:flex;gap:10px;margin:8px 0 2px;flex-wrap:wrap}
  .pill{border:1px solid #394056;border-radius:999px;padding:2px 8px;font-size:12px}
  .ok{color:#cfe; border-color:#3d5369}
  .bar{height:8px;border-radius:6px;background:#1e2436;overflow:hidden}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,#6df,#9f8fff);width:0%}
  textarea{width:100%;min-height:84px;border:1px solid #2a2f48;background:#0f0f17;color:var(--ink);
           border-radius:10px;padding:10px;resize:vertical}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .tw{animation:fade .35s ease}
  @keyframes fade{from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none}}
  /* æ˜Ÿç‚¹é—ªçƒåé¦ˆ */
  body.starflash{background:
     radial-gradient(1200px 600px at 50% 50%,rgba(255,255,255,.07),transparent 40%) no-repeat var(--bg);
     transition:background .25s ease}
  /* é¡¶éƒ¨èº«ä»½é€‰æ‹©å™¨ */
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:12px}
  .who{display:flex;align-items:center;gap:8px}
  select{background:#0f0f17;color:var(--ink);border:1px solid #2a2f48;border-radius:10px;padding:6px 8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <h1>Dodva Flow Console âœ¨ <span id="whoText" class="muted"></span></h1>
    <div class="who">
      <span class="muted">åˆ‡æ¢èº«ä»½</span>
      <select id="userSel">
        <option value="xinyue">xinyue</option>
        <option value="mengmeng">mengmeng</option>
      </select>
    </div>
  </div>

  <!-- ç§¯åˆ†çœ‹æ¿ -->
  <div class="kpi">
    <span class="pill">âš¡ Spark <b id="k_spark">0</b></span>
    <span class="pill">ğŸŒŠ Flow <b id="k_flow">0</b></span>
    <span class="pill">ğŸª Soul <b id="k_soul">0</b></span>
    <span class="pill ok">ğŸ”¥ Streak <b id="k_streak">0</b>d</span>
  </div>

  <div class="grid">
    <!-- A. 1åˆ†é’Ÿå‘¼å¸ -->
    <section class="card">
      <h2>1 åˆ†é’Ÿå‘¼å¸ï¼ˆç¨³ä½ï¼‰</h2>
      <p class="muted">è·Ÿéš 60s å€’è®¡æ—¶ï¼šå¸ 4ï½œåœ 2ï½œå‘¼ 4ã€‚å®Œæˆ + ğŸŒŠ5, âš¡1</p >
      <div class="bar"><i id="breatheBar"></i></div>
      <div class="row" style="margin-top:10px">
        <button id="btnBreathe" class="btn">å¼€å§‹ 60s</button>
        <span id="breatheLeft" class="mono muted">â€”</span>
      </div>
    </section>

    <!-- B. ä¸‰è¡Œæ—¥è®° -->
    <section class="card">
      <h2>ä¸‰è¡Œæ—¥è®°ï¼ˆä¸å¯èƒ½å¤±è´¥ï¼‰</h2>
      <p class="muted">å†™ä¸‹ 3 å¥ï¼šæ„Ÿå— / æ„Ÿè°¢ / ä¸‹ä¸€æ­¥ã€‚å®Œæˆ + ğŸŒŠ4, ğŸª3</p >
      <textarea id="j1" placeholder="1ï¼‰æˆ‘ç°åœ¨çš„æ„Ÿå—æ˜¯â€¦"></textarea>
      <textarea id="j2" placeholder="2ï¼‰æˆ‘ä»Šå¤©æ„Ÿè°¢â€¦"></textarea>
      <textarea id="j3" placeholder="3ï¼‰æˆ‘ä¸‹ä¸€æ­¥æœ€å°è¡ŒåŠ¨â€¦"></textarea>
      <div class="row" style="margin-top:10px">
        <button id="btnJournal" class="btn">ä¿å­˜ä»Šå¤©</button>
        <span id="journalInfo" class="muted">æœªä¿å­˜</span>
      </div>
    </section>

    <!-- C. 100 å­—å†™ä½œ -->
    <section class="card">
      <h2>100 å­—å†™ä½œï¼ˆç‚¹ç«+åˆ›é€ ï¼‰</h2>
      <p class="muted" id="prompt">æç¤ºåŠ è½½ä¸­â€¦</p >
      <textarea id="draft" placeholder="è‡ªç”±å†™ï¼Œä¸ç”¨å®Œç¾ã€‚åˆ° 100 å­—è‡ªåŠ¨å®Œæˆã€‚"></textarea>
      <div class="bar"><i id="wordBar"></i></div>
      <div class="row" style="margin-top:10px">
        <span class="mono muted">å­—æ•°ï¼š<b id="wc">0</b>/100</span>
        <button id="btnClear" class="btn">æ¸…ç©º</button>
      </div>
      <p class="muted">è¾¾æ ‡ + ğŸª8, ğŸŒŠ3</p >
    </section>

    <!-- D. ä»Šæ—¥ç›²ç›’ -->
    <section class="card">
      <h2>ä»Šæ—¥ç›²ç›’ï¼ˆå¯å˜å¥–åŠ±ï¼‰</h2>
      <p class="muted">æ¯å¤©ä¸€æ¬¡ï¼Œå¯èƒ½æ‰è½è´´çº¸/é¢å¤–ç§¯åˆ†/éšè—ç¥ç¦</p >
      <button id="btnRoll" class="btn">æ‰“å¼€ç›²ç›’</button>
      <p id="rollMsg" class="tw"></p >
    </section>
  </div>
</div>

<script>
/* ========= èº«ä»½ & å‘½åç©ºé—´ ========= */
function getUser() {
  const u = new URLSearchParams(location.search).get('u');
  return (u && /^[a-z0-9_-]{1,20}$/i.test(u)) ? u.toLowerCase() : 'xinyue';
}
const USER = getUser();
function nsKey(k){ return `du_${USER}_${k}`; }
document.getElementById('whoText').textContent = `| å½“å‰ï¼š@${USER}`;
const sel = document.getElementById('userSel'); sel.value = USER;
sel.addEventListener('change', ()=>{
  const url = new URL(location.href);
  url.searchParams.set('u', sel.value);
  location.href = url.toString();
});

/* ========= æœ¬åœ°çŠ¶æ€ï¼ˆlocalStorageï¼‰ ========= */
const todayKey = new Date().toISOString().slice(0,10);
const S = JSON.parse(localStorage.getItem(nsKey('state'))||'{}');
if(S.date!==todayKey){ S.date=todayKey; S.breathed=false; S.journal=false; S.roll=false; S._wDone=false; }
S.spark = S.spark||0; S.flow=S.flow||0; S.soul=S.soul||0; S.streak=S.streak||0;
function save(){ localStorage.setItem(nsKey('state'), JSON.stringify(S)); refreshKPI(); }
function refreshKPI(){ qs('#k_spark').textContent=S.spark; qs('#k_flow').textContent=S.flow; qs('#k_soul').textContent=S.soul; qs('#k_streak').textContent=S.streak; }
function qs(s){return document.querySelector(s)}
function star(){ document.body.classList.add('starflash'); setTimeout(()=>document.body.classList.remove('starflash'),220); }

/* streakï¼šå½“å¤©ä»»æ„ä»»åŠ¡å®Œæˆä¸€æ¬¡å°±è®°ä¸ºç»­ä¸€å¤©ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰ */
function markStreakOnce(){
  if(S._streakMarked===todayKey) return;
  const last = localStorage.getItem(nsKey('last_day'));
  const y = new Date(Date.now()-86400000).toISOString().slice(0,10);
  if(last===y) S.streak = (S.streak||0)+1; else S.streak = 1;
  localStorage.setItem(nsKey('last_day'), todayKey);
  S._streakMarked=todayKey; save();
}

/* ========= A. 60s å‘¼å¸ ========= */
const btnBreathe = qs('#btnBreathe'), barA = qs('#breatheBar'), left = qs('#breatheLeft');
let timerA=null, tLeft=60;
function tickA(){
  left.textContent = tLeft+'s';
  barA.style.width = (100*(60-tLeft)/60)+'%';
  if(tLeft<=0){ clearInterval(timerA); timerA=null; btnBreathe.disabled=false; left.textContent='å®Œæˆï¼';
    if(!S.breathed){ S.flow+=5; S.spark+=1; S.breathed=true; save(); star(); markStreakOnce(); }
    return;
  }
  tLeft--;
}
btnBreathe.onclick = ()=>{
  if(timerA) return;
  tLeft=60; tickA(); timerA=setInterval(tickA,1000); btnBreathe.disabled=true;
};

/* ========= B. ä¸‰è¡Œæ—¥è®° ========= */
const j1=qs('#j1'), j2=qs('#j2'), j3=qs('#j3'), btnJ=qs('#btnJournal'), jInfo=qs('#journalInfo');
function loadJournal(){
  const k=nsKey('journal_'+todayKey);
  const v=JSON.parse(localStorage.getItem(k)||'null');
  if(v){ j1.value=v[0]; j2.value=v[1]; j3.value=v[2]; S.journal=true; btnJ.disabled=true; jInfo.textContent='âœ” å·²ä¿å­˜'; }
}
btnJ.onclick = ()=>{
  const ok = [j1.value.trim(), j2.value.trim(), j3.value.trim()].filter(Boolean).length>=3;
  if(!ok) { jInfo.textContent='å…ˆå†™æ»¡ 3 è¡Œå™¢ï½'; return; }
  localStorage.setItem(nsKey('journal_'+todayKey), JSON.stringify([j1.value,j2.value,j3.value]));
  if(!S.journal){ S.flow+=4; S.soul+=3; S.journal=true; save(); star(); markStreakOnce(); }
  btnJ.disabled=true; jInfo.textContent='âœ” å·²ä¿å­˜';
};
loadJournal();

/* ========= C. 100 å­—å†™ä½œ ========= */
const prompts = [
 "ç»™ 12 å²çš„è‡ªå·±å†™ä¸€å° 100 å­—çŸ­ä¿¡ï¼Œåªè¯´ä¸€ä¸ªå‹‡æ•¢ç¬é—´ã€‚",
 "æŠŠä»Šæ™šçš„é£æè¿°æˆä¸€ç§ç”Ÿç‰©ï¼Œè®©å®ƒå¼€å£è¯´è¯ã€‚",
 "å¦‚æœä½ èƒ½åœ¨æ¢¦é‡Œè§åˆ°ä¸€é¢—æ˜Ÿï¼Œè¯·å†™ä¸‹ä½ ä»¬ 100 å­—çš„å¯¹è¯ã€‚",
 "æŠŠâ€œå®³æ€•â€æ‹†æˆä¸‰æ ·å¯è§¦æ‘¸çš„ç‰©ä»¶ï¼Œå†æŠŠå®ƒä»¬æ”¾å›å£è¢‹ã€‚",
 "åœ¨å¦ä¸€ä¸ªå®‡å®™ï¼Œä»Šå¤©çš„ä½ ä¼šåšå“ªä¸€ä»¶å°äº‹ï¼Ÿ"
];
function dailyIndex(seed){
  const d = new Date(), key = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}|${seed}`;
  let h=2166136261; for(let i=0;i<key.length;i++){ h^=key.charCodeAt(i); h=Math.imul(h,16777619); }
  return Math.abs(h)%prompts.length;
}
qs('#prompt').textContent = prompts[dailyIndex(USER)];

const draft=qs('#draft'), wc=qs('#wc'), barW=qs('#wordBar'), btnClear=qs('#btnClear');
function countWords(s){ return (s.trim().match(/\S+/g)||[]).length; }
function renderWC(){
  const n = countWords(draft.value); wc.textContent=n;
  const p = Math.min(100, Math.round(100*n/100)); barW.style.width=p+'%';
  if(n>=100 && !S._wDone){ S.soul+=8; S.flow+=3; S._wDone=true; save(); star(); markStreakOnce(); }
}
draft.addEventListener('input', renderWC);
btnClear.onclick = ()=>{ draft.value=''; S._wDone=false; renderWC(); }
renderWC();

/* ========= æ‰“å­—æœºï¼ˆç”¨äºç›²ç›’æç¤ºï¼‰ ========= */
async function typeText(el,msg,spd=28){ el.textContent=''; for(let i=0;i<msg.length;i++){ el.textContent=msg.slice(0,i+1); star(); await new Promise(r=>setTimeout(r,spd)); } }

/* ========= D. ä»Šæ—¥ç›²ç›’ï¼ˆæ¯æ—¥ä¸€æ¬¡ï¼ŒæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰ ========= */
const btnRoll=qs('#btnRoll'), rollMsg=qs('#rollMsg');
const loot = [
  {t:"è·å¾—è´´çº¸ï¼šå°ç«ç„° ğŸ”¥", act:()=>{S.spark+=2}},
  {t:"é¢å¤–ç§¯åˆ†ï¼šğŸŒŠ +2", act:()=>{S.flow+=2}},
  {t:"é¢å¤–ç§¯åˆ†ï¼šğŸª +2", act:()=>{S.soul+=2}},
  {t:"éšè—ç¥ç¦ï¼šä½ å·²è¢«å®‡å®™è½»è½»æ‹¥æŠ±ã€‚", act:()=>{}},
  {t:"å†æ¥å†å‰ï¼šé€ä½ ä¸€ä¸ªæ·±å‘¼å¸ã€‚", act:()=>{}},
];
function rollKey(){ return nsKey('roll_'+todayKey); }
const rolled = localStorage.getItem(rollKey());
if(rolled){ btnRoll.disabled=true; typeText(rollMsg, rolled); }
btnRoll.onclick = async()=>{
  if(localStorage.getItem(rollKey())) return;
  const bag=[0,0,0,1,2,3,4][Math.floor(Math.random()*7)]; // ç®€å•åŠ æƒ
  const drop = loot[bag]; drop.act(); save(); star();
  btnRoll.disabled=true;
  localStorage.setItem(rollKey(), drop.t);
  await typeText(rollMsg, drop.t);
  markStreakOnce();
};

/* ========= åˆå§‹æ¸²æŸ“ ========= */
refreshKPI();
</script>
<a class="btn" id="linkflow" href="flow.html">ğŸ  Flow Console</a >
<script>
  // ç»Ÿä¸€å¸¦ä¸Šèº«ä»½å‚æ•°
  function getUser(){const u=new URLSearchParams(location.search).get('u');return (u&&/^[a-z0-9_-]{1,20}$/i.test(u))?u.toLowerCase():'xinyue'}
  const USER = getUser();
  document.getElementById('linkflow').href = `/?u=${USER}`;  // ğŸ‘ˆ æ ¹è·¯å¾„ï¼Œä»»ä½•å­ç›®å½•éƒ½èƒ½å›åˆ°é¦–é¡µ
</script>
</body>
</html>