<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva · 学习室</title>
<style>
  :root{--bg:#0b0f1a;--fg:#eaf2ff;--mut:#a3b4d8;--line:#2a2f48}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;padding:10px 14px;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(180deg,rgba(14,14,22,.7),rgba(14,14,22,.45));backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .btn{border:1px solid #3b3f59;border-radius:10px;padding:7px 12px;background:#12121b;color:#eaf2ff;cursor:pointer}
  .wrap{max-width:1000px;margin:0 auto;padding:16px}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
  .card{border:1px solid var(--line);border-radius:16px;padding:16px;background:linear-gradient(180deg,rgba(14,14,22,.9),rgba(14,14,22,.6));box-shadow:0 10px 28px rgba(0,0,0,.45)}
  .mut{color:var(--mut);font-size:13px}
  /* 日历 */
  .cal{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px}
  .cell{border:1px solid #2a2f48;border-radius:10px;height:90px;padding:6px;display:flex;flex-direction:column;gap:4px}
  .cell .d{font-size:12px;color:#a3b4d8}
  .task{font-size:12px;background:#132033;color:#cfe3ff;border-radius:6px;padding:2px 6px}
  .today{outline:2px solid #5eead4}
  input,select{border:1px solid #3b3f59;border-radius:10px;background:#0f0f17;color:#eaf2ff;padding:7px 10px}
</style>
</head>
<body>
<header>
  <div>
    <a class="btn" href=" ">🏠 Home</a >
    <button class="btn" onclick="DUi18n.toggle()" id="langBtn">🌐 EN/中文</button>
  </div>
  <button class="btn" onclick="duPay.modal()">💎 订阅 Pro</button>
</header>

<div class="wrap">
  <div class="grid">
    <!-- 番茄钟 -->
    <section class="card">
      <h2 data-i18n="flow.pomo">番茄钟</h2>
      <div class="mut" data-i18n="flow.pomoTip">默认 25 / 5，完成后自动进入休息</div>
      <div style="font-size:40px;margin:8px 0" id="clock">25:00</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="start">▶️</button>
        <button class="btn" id="pause">⏸</button>
        <button class="btn" id="reset">⟲</button>
        <label class="mut">F<input id="focus" type="number" value="25" min="5" max="90" style="width:70px;margin-left:6px"/></label>
        <label class="mut">B<input id="break" type="number" value="5" min="3" max="30" style="width:70px;margin-left:6px"/></label>
        <span class="mut" id="state">Focus</span>
      </div>
    </section>

    <!-- Game Plan 日历 -->
    <section class="card">
      <h2 data-i18n="flow.plan">Game Plan 日历</h2>
      <div class="mut" id="ym"></div>
      <div class="cal" id="cal"></div>
      <div style="display:flex;gap:8px;align-items:center;margin-top:10px;flex-wrap:wrap">
        <input id="taskTxt" placeholder="今天要做什么…"/>
        <input id="taskDate" type="date"/>
        <button class="btn" id="addTask" data-i18n="flow.add">添加</button>
      </div>
    </section>
  </div>
</div>

<script src="du-i18n.js"></script>
<script src="du-pay.js"></script>
<script>
// ===== 番茄钟 =====
let t=null, left=25*60, mode='focus';
const $=s=>document.querySelector(s);
function draw(){ const m=String((left/60|0)).padStart(2,'0'), s=String(left%60).padStart(2,'0'); $('#clock').textContent=`${m}:${s}`; $('#state').textContent = mode==='focus'?'Focus':'Break'; }
function step(){ left--; if(left<=0){ if(mode==='focus'){ mode='break'; left=(+$('#break').value)*60; } else{ mode='focus'; left=(+$('#focus').value)*60; } draw(); } }
$('#start').onclick=()=>{ if(t)return; t=setInterval(()=>{ step(); draw(); },1000); };
$('#pause').onclick=()=>{ clearInterval(t); t=null; };
$('#reset').onclick=()=>{ clearInterval(t); t=null; mode='focus'; left=(+$('#focus').value)*60; draw(); };
$('#focus').onchange=$('#break').onchange=()=>{ if(mode==='focus'){ left=(+$('#focus').value)*60 } else { left=(+$('#break').value)*60 } ; draw(); };
draw();

// ===== 轻量日历（本地存储） =====
const CAL = { y:new Date().getFullYear(), m:new Date().getMonth(), tasks: JSON.parse(localStorage.getItem('du_tasks')||'{}') };
function keyOf(d){ return d.toISOString().slice(0,10); }
function saveTasks(){ localStorage.setItem('du_tasks', JSON.stringify(CAL.tasks)); }
function renderCal(){
  const first=new Date(CAL.y, CAL.m,1), last=new Date(CAL.y, CAL.m+1,0);
  $('#ym').textContent=`${CAL.y}-${String(CAL.m+1).padStart(2,'0')}`;
  const box=$('#cal'); box.innerHTML='';
  // 前导空白
  for(let i=0;i<((first.getDay()+6)%7);i++){ box.appendChild(document.createElement('div')); }
  for(let d=1; d<=last.getDate(); d++){
    const cell=document.createElement('div'); cell.className='cell';
    const dt=new Date(CAL.y, CAL.m, d); const k=keyOf(dt);
    const label=document.createElement('div'); label.className='d'; label.textContent=d;
    const list=document.createElement('div'); 
    (CAL.tasks[k]||[]).forEach(t=>{ const chip=document.createElement('div'); chip.className='task'; chip.textContent=t; list.appendChild(chip); });
    cell.append(label,list);
    if(k===keyOf(new Date())) cell.classList.add('today');
    cell.onclick=()=>{ $('#taskDate').value=k; $('#taskTxt').focus(); }
    box.appendChild(cell);
  }
}
$('#addTask').onclick=()=>{
  const txt=$('#taskTxt').value.trim(); const day=$('#taskDate').value || keyOf(new Date());
  if(!txt) return;
  CAL.tasks[day] = CAL.tasks[day]||[]; CAL.tasks[day].push(txt); saveTasks(); $('#taskTxt').value=''; renderCal();
};
renderCal();
</script>
</body>
</html>