<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva · 今日能量卡</title>
<style>
  :root{--bg:#0b0f1a;--fg:#eaf2ff;--mut:#a3b4d8;--line:#2a2f48}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;z-index:5;display:flex;gap:8px;align-items:center;justify-content:space-between;
    padding:10px 14px;background:linear-gradient(180deg,rgba(14,14,22,.7),rgba(14,14,22,.45));backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{border:1px solid #3b3f59;border-radius:10px;padding:7px 12px;background:#12121b;color:#eaf2ff;cursor:pointer;text-decoration:none}
  .wrap{max-width:900px;margin:0 auto;padding:16px}
  .card{border:1px solid var(--line);border-radius:16px;padding:16px;background:linear-gradient(180deg,rgba(14,14,22,.9),rgba(14,14,22,.6));box-shadow:0 10px 28px rgba(0,0,0,.45)}
  .mut{color:var(--mut);font-size:13px}
  .board{margin-top:12px;border:1px solid var(--line);border-radius:14px;padding:16px;background:
    radial-gradient(600px 280px at 70% -10%,rgba(164,120,255,.08),transparent 60%),#0b0f1a}
  h1{font-size:22px;margin:8px 0}
  .big{font-size:18px;line-height:1.7;margin:0}
  .foot{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-top:12px}
  select{border:1px solid #3b3f59;background:#12121b;color:#eaf2ff;border-radius:10px;padding:7px 10px}
  .badge{border:1px solid #3b3f59;border-radius:999px;padding:3px 8px;font-size:12px;color:#cfe3ff}
  textarea{width:100%;min-height:120px;border:1px dashed #3b3f59;border-radius:10px;background:#0f0f17;color:#eaf2ff;padding:10px}
</style>
</head>
<body>
<header>
  <div class="row">
    <a class="btn" href=" " data-i18n="nav.home">🏠 返回首页</a >
    <button class="btn" onclick="DUi18n.toggle()" id="langBtn">🌐 EN/中文</button>
  </div>
  <div class="row">
    <button class="btn" onclick="duPay.modal()" data-i18n="cta.subscribe">💎 订阅 Pro</button>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <h1 data-i18n="energy.title">今日能量卡</h1>
    <div class="mut" data-i18n="energy.tip">选择主题，翻一张属于你的宇宙签语。</div>

    <div class="row" style="margin-top:10px">
      <label class="mut" for="topic" data-i18n="energy.topic">主题</label>
      <select id="topic">
        <option value="heal" data-i18n="topic.heal">疗愈</option>
        <option value="love" data-i18n="topic.love">关系</option>
        <option value="wealth" data-i18n="topic.wealth">财富</option>
        <option value="focus" data-i18n="topic.focus">专注</option>
      </select>
      <span class="badge" id="badgeCount">—</span>
    </div>

    <div class="board">
      <p class="big" id="line">…</p >
      <div class="foot">
        <div class="row">
          <button class="btn" id="prevBtn" data-i18n="energy.prev">上一张</button>
          <button class="btn" id="nextBtn" data-i18n="energy.next">下一张</button>
          <button class="btn" id="shuffleBtn" data-i18n="energy.shuffle">随机</button>
        </div>
        <div class="row">
          <button class="btn" id="copyBtn" data-i18n="energy.copy">复制文案</button>
          <button class="btn" id="shareBtn" data-i18n="energy.share">分享链接</button>
        </div>
      </div>
    </div>

    <details style="margin-top:12px">
      <summary class="mut" data-i18n="energy.import">批量导入词库（CSV，每行一句；可选 #tag）</summary>
      <textarea id="csv" placeholder="在此粘贴：句子, tag1 tag2"></textarea>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="importBtn" data-i18n="energy.importBtn">导入到当前主题</button>
        <span class="mut" id="importMsg"></span>
      </div>
    </details>
  </div>
   <div>
       <div class="card">
         <h3>🧘 每日冥想专属频道</h3>
         <p>逃离到你专属小宇宙</p>
       </div>
      <a class="pill" href="meditation.html">🧘 进入冥想</a >

       <div class="card">
      <div>
        <h3>🎁 生成 AI 礼物卡</h3>
        <p>AI + 全息 + 情感干涉，一张会回应你的「宇宙爱卡」。</p>
        <button id="ecGift" class="pill">🎁 生成 AI 礼物卡</button>
      </div>
  
  </div>

</div>

<script src="du-i18n.js"></script>
<script src="du-pay.js"></script>
<script>
// ===== 默认词库（可随时扩容/导入） =====
const SEEDS = {
  heal: [
    "把“必须”改成“我选择”。",
    "请把害怕折成纸鹤，放进口袋。",
    "让今晚的风替你揉揉心。",
  ],
  love: [
    "你是答案，不是问题。",
    "被你看见，是一种发光。",
    "宇宙偏爱与你串联。",
  ],
  wealth: [
    "把注意力投给会复利的事。",
    "把时间当成你最好的合伙人。",
    "小步快跑，也有指数曲线。",
  ],
  focus: [
    "把手机放下 25 分钟，世界会更安静。",
    "先写一行，再写第二行。",
    "做 1 件对你重要的小事就好。",
  ]
};

// ===== 状态 & 工具 =====
const $ = s=>document.querySelector(s);
let curr = { topic:'heal', idx:0 };

function list(){ return SEEDS[curr.topic] || (SEEDS[curr.topic]=[]); }
function show(i){
  const arr=list(); if(!arr.length){ $('#line').textContent='(空)'; $('#badgeCount').textContent='0'; return; }
  curr.idx = (i%arr.length+arr.length)%arr.length;
  $('#line').textContent = arr[curr.idx];
  $('#badgeCount').textContent = `${arr.length}`;
  localStorage.setItem('du_energy_state', JSON.stringify(curr));
}
function shuffle(){ const arr=list(); if(!arr.length) return; show(Math.floor(Math.random()*arr.length)); }

// ===== 事件绑定 =====
$('#topic').addEventListener('change', e=>{ curr.topic=e.target.value; curr.idx=0; show(0); });
$('#prevBtn').onclick = ()=> show(curr.idx-1);
$('#nextBtn').onclick = ()=> show(curr.idx+1);
$('#shuffleBtn').onclick = shuffle;
$('#copyBtn').onclick = async ()=>{
  try{ await navigator.clipboard.writeText($('#line').textContent); alert(DUi18n.get()==='zh'?'已复制':'Copied!'); }catch(e){ alert('Copy failed');}
};
$('#shareBtn').onclick = ()=>{
  const url = new URL(location.href);
  url.searchParams.set('t', curr.topic);
  url.searchParams.set('i', curr.idx);
  navigator.clipboard.writeText(url.toString());
  alert(DUi18n.get()==='zh'?'已复制链接':'Link copied');
};
$('#importBtn').onclick = ()=>{
  const txt = $('#csv').value.trim(); if(!txt) return;
  const lines = txt.split(/\n+/).map(s=>s.trim()).filter(Boolean);
  for(const ln of lines){
    const seg = ln.split(',')[0].trim();
    if(seg) list().push(seg);
  }
  $('#csv').value=''; $('#importMsg').textContent = (DUi18n.get()==='zh'?'已导入 ':'Imported ')+lines.length;
  show(list().length-1);
};

// ===== 恢复 URL / 本地状态 =====
 ;(function(w){
  const KEY='du_lang';
  let lang = localStorage.getItem(KEY) || (navigator.language||'').toLowerCase().startsWith('zh') ? 'zh' : 'en';

  const dict = {
    zh:{
      "nav.home":"🏠 返回首页",
      "cta.subscribe":"订阅 Pro",
      "energy.title":"今日能量卡",
      "energy.tip":"选择主题，翻一张属于你的宇宙签语。",
      "energy.topic":"主题",
      "topic.heal":"疗愈","topic.love":"关系","topic.wealth":"财富","topic.focus":"专注",
      "energy.prev":"上一张","energy.next":"下一张","energy.shuffle":"随机",
      "energy.copy":"复制文案","energy.share":"分享链接",
      "energy.import":"批量导入词库（CSV，每行一句；可选 #tag）","energy.importBtn":"导入到当前主题",
      "med.title":"粉晶冥想 · 呼吸引导","med.tip":"跟随光环：吸气4｜停4｜呼气6。选择频率与环境层，按「开始」。",
      "med.start":"开始","med.pause":"暂停","med.reset":"重置",
      "flow.pomo":"番茄钟","flow.pomoTip":"默认 25 / 5，完成后自动进入休息","flow.plan":"Game Plan 日历","flow.add":"添加"
    },
    en:{
      "nav.home":"🏠 Home",
      "cta.subscribe":"Subscribe Pro",
      "energy.title":"Energy Card · Today",
      "energy.tip":"Pick a theme and draw a line from the universe.",
      "energy.topic":"Topic",
      "topic.heal":"Healing","topic.love":"Relationship","topic.wealth":"Wealth","topic.focus":"Focus",
      "energy.prev":"Prev","energy.next":"Next","energy.shuffle":"Shuffle",
      "energy.copy":"Copy","energy.share":"Share Link",
      "energy.import":"Bulk import CSV (one line per row; optional #tags)","energy.importBtn":"Import to current theme",
      "med.title":"Rose Quartz Meditation · Guided Breathing","med.tip":"Follow the ring: inhale 4 | hold 4 | exhale 6. Pick frequency & ambience.",
      "med.start":"Start","med.pause":"Pause","med.reset":"Reset",
      "flow.pomo":"Pomodoro","flow.pomoTip":"25/5 by default; auto switch to break","flow.plan":"Game Plan Calendar","flow.add":"Add"
    }
  };

  function t(key){ return (dict[lang] && dict[lang][key]) || key; }
  function apply(root=document){
    root.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n'); const txt = t(key);
      if(el.placeholder!==undefined && /placeholder/i.test(el.tagName)===false && el.hasAttribute('data-i18n-placeholder')){
        el.placeholder = txt;
      }
      el.textContent = txt;
    });
  }
  function set(l){ lang=l; localStorage.setItem(KEY,l); apply(); w.dispatchEvent(new CustomEvent('du:lang',{detail:l})); }
  function toggle(){ set(lang==='zh'?'en':'zh'); }

  w.DUi18n = { set, toggle, apply, get:()=>lang, dict };
  document.addEventListener('DOMContentLoaded', ()=> apply());
})(window);
(function init(){
  const u = new URL(location.href);
  const t = u.searchParams.get('t'); const i = +u.searchParams.get('i');
  const saved = JSON.parse(localStorage.getItem('du_energy_state')||'{}');
  curr.topic = t || saved.topic || 'heal';
  curr.idx   = Number.isFinite(i)? i : (saved.idx||0);
  $('#topic').value = curr.topic;
  show(curr.idx);
})();

// 切换按钮文案
window.addEventListener('du:lang', ()=>{
  $('#langBtn').textContent = (DUi18n.get()==='zh'?'🌐 英文':'🌐 Chinese');
});
;(function(w,d){
  // 改这里即可全站切换支付链接
  const CONF = {
    monthly: 'https://dodva-noise-gumx.vercel.app/api/checkout?plan=monthly',
    yearly:  'https://dodva-noise-gumx.vercel.app/api/checkout?plan=yearly',
    backTo:  'index.html#subscribe' // 支持从子页跳回首页订阅区
  };

  let inited=false, host=null;
  function init(){
    if(inited) return; inited=true;
    host = d.createElement('div'); host.style.cssText='position:fixed;inset:0;display:none;z-index:99999;background:rgba(0,0,0,.65);backdrop-filter:blur(6px)';
    host.innerHTML = `
      <div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(92vw,540px);background:#0b0f1a;border:1px solid #2a2f48;border-radius:16px;padding:18px;box-shadow:0 22px 60px rgba(0,0,0,.55)">
        <h3 style="margin:0 0 8px">💎 Dodva Pro</h3>
        <p style="margin:0 0 12px;color:#b8bed1;font-size:14px">AI 陪伴 · 白噪音引擎 · 冥想频道 · 玩具柜扩展</p >
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="du-btn" href=" " style="flex:1;min-width:180px;text-align:center;border:1px solid #3b3f59;border-radius:10px;padding:10px 12px;background:#12121b;color:#eaf2ff;text-decoration:none">💠 $9.9 / 月</a >
          <a class="du-btn" href="${CONF.yearly}"  style="flex:1;min-width:180px;text-align:center;border:1px solid #94a3b8;border-radius:10px;padding:10px 12px;background:#e2e8f0;color:#0b1220;text-decoration:none;font-weight:700">🌌 $79 / 年</a >
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <a href="${CONF.backTo}" style="color:#93c5fd;text-decoration:none">⇠ 回到订阅说明</a >
          <button id="duPayClose" style="border:1px solid #3b3f59;border-radius:10px;background:transparent;color:#eaf2ff;padding:6px 10px;cursor:pointer">关闭</button>
        </div>
      </div>`;
    d.body.appendChild(host);
    host.addEventListener('click', e=>{ if(e.target===host) close(); });
    d.getElementById('duPayClose').addEventListener('click', close);
  }
  function open(plan){
    init();
    if(typeof plan==='string' && CONF[plan]){
      location.href = CONF[plan]; return;
    }
    host.style.display='block';
  }
  function close(){ host.style.display='none'; }
  function set(k,v){ CONF[k]=v; }
  w.duPay = { open, modal: open, close, set, conf: CONF };
})(window, document);
</script>
</body>
</html>