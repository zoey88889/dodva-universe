ï¼ˆ<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ¢¦å¢ƒæ˜Ÿ Â· Dodva Universe</title>
<link rel="stylesheet" href="style.css">
<style>
  .dream-form {display:grid;gap:12px}
  .dream-list {display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:16px}
  .dream-card {border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px;background:rgba(255,255,255,.04)}
  .dream-card img{max-width:100%;border-radius:10px;border:1px solid rgba(255,255,255,.1);margin-top:8px}
  .dream-card .tag{font-size:.85rem;color:var(--muted)}
  input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.25);color:var(--ink)}
  button{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:var(--ink);cursor:pointer}
  button:hover{background:rgba(255,255,255,.14)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
</style>
</head>
<body>
<header>
  <div>ğŸŒ™ æ¢¦å¢ƒæ˜Ÿ</div>
  <nav>
    <a href="index.html">é¦–é¡µ</a>
    <a href="dream-map.html">Dream Map</a>
    <a href="gallery.html">Gallery</a>
    <a href="upload.html">ä¸Šä¼ æ¢¦å¢ƒ</a>
  </nav>
</header>

<div class="container">
  <div class="card">
    <h2>æäº¤ä½ çš„æ¢¦å¢ƒ</h2>
    <p class="notice">è¯´æ˜ï¼šæœ¬é¡µæäº¤çš„æ•°æ®ä»…ä¿å­˜åœ¨æœ¬æœºæµè§ˆå™¨çš„ <b>localStorage</b>ï¼ˆåŸå‹ç”¨ï¼‰ã€‚åœ°å›¾ä¸ä¸‹æ–¹åˆ—è¡¨é»˜è®¤è¯»å– <code>dreams.json</code>ã€‚</p>

    <form id="dreamForm" class="dream-form" autocomplete="off">
      <div class="row">
        <label>æ˜µç§°
          <input name="nickname" placeholder="ä½ çš„åå­—" required></label>
        <label>æ ‡é¢˜
          <input name="title" placeholder="æ¢¦å¢ƒæ ‡é¢˜" required></label>
      </div>

      <label>æè¿°
        <textarea name="description" rows="4" placeholder="å†™ä¸‹ç”»é¢ã€æƒ…ç»ªã€å¯ç¤ºâ€¦" required></textarea></label>

      <label>å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼Œé€‰å¡«ï¼‰
        <input name="tags" placeholder="é“¶ç™½é±¼, æ¼©æ¶¡, åº¦å‡å²›"></label>

      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <button type="submit">âœ¨ å‘å¸ƒæ¢¦å¢ƒï¼ˆä»…å­˜æœ¬æœºï¼‰</button>
        <button type="button" id="clearBtn">æ¸…ç©ºæœ¬åœ°æ•°æ®</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>æœ€æ–°æ¢¦å¢ƒ</h2>

    <!-- å°±æ”¾åœ¨â€œæœ€æ–°æ¢¦å¢ƒâ€æ ‡é¢˜æ­£ä¸‹æ–¹ -->
    <button id="showLocal">æŸ¥çœ‹æœ¬åœ°æ¢¦å¢ƒæ•°æ®</button>

    <div id="list" class="dream-list" style="margin-top:12px"></div>
  </div>
</div>

<footer>Â© 2025 Dodva Universe</footer>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const KEY   = 'dodva_dreams_v1';
    const $form = document.getElementById('dreamForm');
    const $list = document.getElementById('list');
    const $clear= document.getElementById('clearBtn');
    const $show = document.getElementById('showLocal');

    // ---- åˆ—è¡¨æ¸²æŸ“ï¼šä¼˜å…ˆè¯» dreams.jsonï¼Œå¤±è´¥å›é€€åˆ° localStorage
    renderNotice('åŠ è½½ä¸­â€¦');
    fetch('dreams.json?_=' + Date.now())
      .then(r => { if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); })
      .then(arr => { if (!Array.isArray(arr) || !arr.length) throw new Error('empty_json'); render(arr); })
      .catch(() => {
        let arr = [];
        try { arr = JSON.parse(localStorage.getItem(KEY) || '[]'); } catch {}
        render(arr);
      });

    // ---- æœ¬åœ°æäº¤ï¼ˆåªå†™å…¥ localStorageï¼Œä¾¿äºä½ åŸå‹è°ƒè¯•ï¼‰
    $form.addEventListener('submit', (e) => {
      e.preventDefault();
      const fd = new FormData($form);
      const item = {
        id: Date.now(),
        nickname: (fd.get('nickname')||'').toString().trim(),
        title: (fd.get('title')||'').toString().trim(),
        description: (fd.get('description')||'').toString().trim(),
        tags: (fd.get('tags')||'').toString().split(',').map(s=>s.trim()).filter(Boolean),
        createdAt: new Date().toISOString()
      };
      let arr = [];
      try { arr = JSON.parse(localStorage.getItem(KEY) || '[]'); } catch {}
      arr.unshift(item);
      localStorage.setItem(KEY, JSON.stringify(arr));
      $form.reset();
      alert('å·²ä¿å­˜åˆ°æœ¬æœºï¼ˆlocalStorageï¼‰ã€‚\nå½“å‰æ¡æ•°ï¼š' + arr.length + '\nåˆ·æ–°åå¦‚ä»ç©ºç™½ï¼Œè¯´æ˜ä½ çœ‹åˆ°çš„æ˜¯ dreams.json çš„è¿œç¨‹æ•°æ®ã€‚');
    });

    // ---- æ¸…ç©ºæœ¬åœ°ç¼“å­˜
    $clear.addEventListener('click', () => {
      if (confirm('ç¡®å®šæ¸…ç©ºæœ¬åœ°ä¿å­˜çš„æ¢¦å¢ƒå—ï¼Ÿï¼ˆä»…å½±å“æœ¬è®¾å¤‡æµè§ˆå™¨ï¼‰')) {
        localStorage.removeItem(KEY);
        alert('å·²æ¸…ç©ºæœ¬åœ°æ•°æ®ã€‚');
      }
    });

    // ---- è°ƒè¯•æŒ‰é’®ï¼šä¸ç”¨è¿›æ§åˆ¶å°ä¹Ÿèƒ½çœ‹æœ¬åœ°æ•°æ®
    $show.addEventListener('click', () => {
      let data = [];
      try { data = JSON.parse(localStorage.getItem(KEY) || '[]'); } catch {}
      alert('å½“å‰æœ¬åœ°ä¿å­˜æ¡æ•°ï¼š' + data.length + '\n\n' + JSON.stringify(data, null, 2));
    });

    // ---- æ¸²æŸ“ & å·¥å…·
    function render(list){
      if (!Array.isArray(list) || !list.length) {
        renderNotice('æš‚æ— æ¢¦å¢ƒã€‚å¯ç‚¹å‡»â€œä¸Šä¼ æ¢¦å¢ƒâ€æˆ–åœ¨æœ¬é¡µæäº¤ä¸€æ¡ï¼ˆä»…å­˜æœ¬æœºï¼‰ã€‚');
        return;
      }
      $list.innerHTML = list.map(d => `
        <div class="dream-card">
          <div class="tag">${safe(dateStr(d.createdAt))}</div>
          <h3>${safe(d.title || 'æœªå‘½åæ¢¦å¢ƒ')}</h3>
          <div class="tag">by ${safe(d.nickname || 'åŒ¿å')}${(d.tags&&d.tags.length)?' Â· '+d.tags.map(safe).join(' Â· '):''}</div>
          ${d.image ? `<img src="${d.image}" alt="dream">` : ''}
          <p>${safe(d.description || '')}</p>
        </div>
      `).join('');
    }
    function renderNotice(text){ $list.innerHTML = `<p class="notice">${safe(text)}</p>`; }
    function safe(s){ return (s||'').toString().replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function dateStr(iso){ try{ return iso ? new Date(iso).toLocaleString() : ''; }catch{ return ''; } }
  });
</script>
</body>
</html>ï¼‰
