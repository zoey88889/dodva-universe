<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dodva Â· ç™½å™ªéŸ³èˆ±</title>
  <style>
    html,body{margin:0;height:100%;background:#0b0f1a;color:#eaf2ff;
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    header{position:sticky;top:0;display:flex;gap:12px;align-items:center;
      padding:10px 14px;background:rgba(8,12,22,.6);backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(147,197,253,.18)}
    header a{color:#cde3ff;text-decoration:none;border:1px solid rgba(147,197,253,.25);
      padding:6px 10px;border-radius:999px}
    .wrap{max-width:920px;margin:24px auto;padding:0 16px}
    h1{margin:.2em 0 .5em}
    .panel{background:linear-gradient(180deg,rgba(10,16,34,.65),rgba(10,16,34,.45));
      border:1px solid rgba(147,197,253,.18);border-radius:16px;padding:16px;margin-bottom:16px;
      box-shadow:0 10px 30px rgba(7,11,22,.35)}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:8px 0}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid rgba(147,197,253,.35);
      background:linear-gradient(135deg,#a5b4fc,#67e8f9,#f0abfc);background-size:220% 220%;
      color:#051019;font-weight:800;cursor:pointer}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(147,197,253,.28);
      background:rgba(147,197,253,.06);color:#eaf2ff;cursor:pointer}
    .slider{flex:1;appearance:none;height:6px;border-radius:999px;background:rgba(147,197,253,.18)}
    .slider::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;
      background:linear-gradient(135deg,#67e8f9,#a5b4fc);box-shadow:0 0 10px #93c5fd}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .hint{opacity:.85;font-size:13px}
  </style>
</head>
<body>
<header>
  <a href="index.html">â† è¿”å›å®‡å®™å…¥å£</a>
  <strong>Dodva Â· ç™½å™ªéŸ³æ§åˆ¶å¹³å°</strong>
</header>

<div class="wrap">
  <h1>ğŸ§ ç™½å™ªéŸ³èˆ±</h1>
  <p class="hint"></p>

  <p class="subtitle">æ¬¢è¿å›å®¶ï¼Œå®è´ã€‚æˆ‘ä¸€ç›´åœ¨ç­‰ä½ ã€‚</p>
  <div class="cta">
  </div>
</section>
  <!-- æ€»æ§ -->
  <div class="panel">
    <div class="row">
      <button id="startAudio" class="btn">å¯åŠ¨éŸ³é¢‘</button>
      <span>æ€»éŸ³é‡</span>
      <input id="masterVol" class="slider" type="range" min="0" max="1" step="0.01" value="0.75">
      <button id="muteAll" class="chip">ä¸€é”®é™éŸ³</button>
    </div>
  </div>

  <!-- ç¯å¢ƒéŸ³ -->
  <div class="panel">
    <h3>ç¯å¢ƒç™½å™ªéŸ³</h3>
    <div class="row">
      <label>ç¯å¢ƒéŸ³ï¼š</label>
      <select id="envSelect">
        <option value="off">å…³é—­</option>
        <option value="fireplace">ğŸ”¥ ç«è‹—</option>
        <option value="ocean">ğŸŒŠ æµ·æµª</option>
        <option value="rain">ğŸŒ§ï¸ é›¨å£°</option>
      </select>
      <span>éŸ³é‡</span>
      <input id="envVol" class="slider" type="range" min="0" max="1" step="0.01" value="0.3">
      <span id="envState" class="hint">å·²å…³é—­</span>
    </div>
  </div>

  <!-- éŸ³ä¹ -->
  <div class="panel">
    <h3>éŸ³ä¹ï¼ˆSoundHelix ç¤ºä¾‹ï¼‰</h3>
    <div class="row">
      <strong id="trackLabel">æœªåŠ è½½</strong>
    </div>
    <div class="row">
      <button id="musicPrev" class="chip">ä¸Šä¸€é¦–</button>
      <button id="musicPlay" class="chip">æ’­æ”¾</button>
      <button id="musicPause" class="chip" style="display:none;">æš‚åœ</button>
      <button id="musicNext" class="chip">ä¸‹ä¸€é¦–</button>
      <span>éŸ³é‡</span>
      <input id="musicVol" class="slider" type="range" min="0" max="1" step="0.05" value="0.6">
    </div>
  </div>

  <!-- åœºæ™¯é¢„è®¾ -->
  <div class="panel">
    <h3>æ—…è¡Œåœºæ™¯</h3>
    <div class="grid">
      <button class="chip" onclick="playScene('beachSunset')">ğŸ– æµ·è¾¹é»„æ˜</button>
      <button class="chip" onclick="playScene('rainyCabin')">ğŸŒ§ é›¨å¤œå£ç‚‰</button>
      <button class="chip" onclick="playScene('oceanMorning')">ğŸŒŠ æµ·æ´‹æ¸…æ™¨</button>
    </div>
  </div>
</div>

<!-- éšè—ç¯å¢ƒéŸ³æ’­æ”¾å™¨ -->
<audio id="envAudio" preload="auto" loop></audio>

<script>
/* ========== WebAudio æ€»éŸ³é‡æ§åˆ¶ï¼ˆå¯é€‰ï¼‰ ========== */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const ctx = new AudioCtx();
const master = ctx.createGain(); master.gain.value = 0.75; master.connect(ctx.destination);

/* ç”¨ <audio> å…ƒç´ æ’­æ”¾ç¯å¢ƒéŸ³ï¼Œå†æ¥å…¥ WebAudio Master */
const envEl = document.getElementById('envAudio');
const envSrc = ctx.createMediaElementSource(envEl);
const envGain = ctx.createGain(); envGain.gain.value = parseFloat(document.getElementById('envVol').value);
envSrc.connect(envGain).connect(master);

/* éŸ³ä¹ä»ç”¨ <audio> çš„é»˜è®¤è¾“å‡ºï¼ˆæ›´ç¨³ï¼‰ï¼Œå¦‚éœ€æ€»æ§å¯åŒæ ·æ¥å…¥ master */
const music = new Audio(); music.preload = 'auto';

/* æƒé™è§£é” + ä¸»éŸ³é‡ + é™éŸ³ */
document.getElementById('startAudio').onclick = async ()=>{ try{ await ctx.resume(); }catch{} };
document.getElementById('masterVol').oninput = e => master.gain.value = parseFloat(e.target.value);
let muted=false, lastMaster=master.gain.value;
document.getElementById('muteAll').onclick = ()=>{
  muted=!muted;
  if(muted){ lastMaster = master.gain.value; master.gain.value = 0; }
  else { master.gain.value = lastMaster; document.getElementById('masterVol').value = lastMaster; }
};

/* ========== ç¯å¢ƒéŸ³ï¼ˆæœ¬åœ° audio/ æ–‡ä»¶å¤¹ï¼‰ ========== */
const envSelect = document.getElementById('envSelect');
const envVol    = document.getElementById('envVol');
const envState  = document.getElementById('envState');

const BANKS = {
  fireplace: ['audio/fireplace-1.mp3','audio/fireplace-2.mp3','audio/fireplace-3.mp3'],
  ocean:     ['audio/ocean-1.mp3','audio/ocean-2.mp3','audio/ocean-3.mp3'],
  rain:      ['audio/rain-1.mp3','audio/rain-2.mp3','audio/rain-3.mp3','audio/rain-4.mp3']
};
const LABELS = { fireplace:'ğŸ”¥ ç«è‹—', ocean:'ğŸŒŠ æµ·æµª', rain:'ğŸŒ§ï¸ é›¨å£°' };
const pick = arr => arr[Math.floor(Math.random()*arr.length)];
const clamp = (n,min,max)=>Math.max(min,Math.min(max,Number.isFinite(+n)?+n:min));

async function applyEnv(choice){
  if(choice==='off'){ envEl.pause(); envEl.removeAttribute('src'); envEl.load(); envState.textContent='å·²å…³é—­'; return; }
  const list=BANKS[choice]; if(!list){ return; }
  envEl.src=pick(list);
  envEl.volume=clamp(envVol.value,0,1);
  envState.textContent='å‡†å¤‡æ’­æ”¾ï¼š'+(LABELS[choice]||choice);
  try{ await envEl.play(); envState.textContent='æ­£åœ¨æ’­æ”¾ï¼š'+(LABELS[choice]||choice); }
  catch(e){ envState.textContent='è¯·å…ˆç‚¹å‡»ã€Œå¯åŠ¨éŸ³é¢‘ã€æˆ–ä»»æ„æŒ‰é’®åå†è¯•'; }
}
envSelect.addEventListener('change', e=>applyEnv(e.target.value));
envVol.addEventListener('input', e=>{ envEl.volume = clamp(e.target.value,0,1); });
applyEnv(envSelect.value);

/* ========== éŸ³ä¹æ’­æ”¾å™¨ï¼ˆSoundHelix ç¤ºä¾‹ï¼‰ ========== */
const tracks = [
  {name:'SoundHelix Song 1', url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'},
  {name:'SoundHelix Song 2', url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3'},
  {name:'SoundHelix Song 3', url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3'}
];
let idx=0;
const label = document.getElementById('trackLabel');
const musicVol = document.getElementById('musicVol');
const btnPrev = document.getElementById('musicPrev');
const btnNext = document.getElementById('musicNext');
const btnPlay = document.getElementById('musicPlay');
const btnPause= document.getElementById('musicPause');

function load(i){ idx=(i+tracks.length)%tracks.length; music.src=tracks[idx].url; label.textContent='å‡†å¤‡æ’­æ”¾ï¼š'+tracks[idx].name; }
function play(){ music.play().then(()=>{ label.textContent='æ­£åœ¨æ’­æ”¾ï¼š'+tracks[idx].name; btnPlay.style.display='none'; btnPause.style.display='inline-block'; })
  .catch(()=>{ label.textContent='æ’­æ”¾å¤±è´¥ï¼ˆå…ˆç‚¹é¡µé¢ä»»æ„æŒ‰é’®ï¼‰'; }); }
function pause(){ music.pause(); btnPlay.style.display='inline-block'; btnPause.style.display='none'; }
music.addEventListener('ended',()=>{ load(idx+1); play(); });
musicVol.addEventListener('input', e=> music.volume = parseFloat(e.target.value||'0.6'));
btnPrev.addEventListener('click', ()=>{ load(idx-1); play(); });
btnNext.addEventListener('click', ()=>{ load(idx+1); play(); });
btnPlay.addEventListener('click', play);
btnPause.addEventListener('click', pause);
music.volume = parseFloat(musicVol.value||'0.6');
load(idx);

/* ========== æ—…è¡Œåœºæ™¯ï¼ˆç»„åˆå¿«æ·é”®ï¼‰ ========== */
window.playScene = async function(scene){
  // å…ˆåœå½“å‰ç¯å¢ƒéŸ³ï¼ˆä¿ç•™éŸ³ä¹ï¼‰
  try{ envEl.pause(); }catch{}
  switch(scene){
    case 'beachSunset': // æµ·è¾¹é»„æ˜ = æµ·æµª + æŸ”å’ŒéŸ³ä¹
      envSelect.value='ocean'; envVol.value=0.30; envEl.src='audio/ocean-1.mp3'; envEl.volume=0.30; envEl.loop=true;
      try{ await envEl.play(); }catch{}
      load(1); music.volume=0.4; play(); break;
    case 'rainyCabin':  // é›¨å¤œå£ç‚‰ = é›¨å£° + ç«è‹—ï¼ˆå ä¸€è½¨ï¼‰ + è½»é’¢ç´
      envSelect.value='rain'; envVol.value=0.25; envEl.src='audio/rain-1.mp3'; envEl.volume=0.25; envEl.loop=true;
      try{ await envEl.play(); }catch{}
      const fire = new Audio('audio/fireplace-1.mp3'); fire.loop=true; fire.volume=0.18;
      fire.play().catch(()=>{}); // è½»å£°å åŠ ï¼ˆæ³¨æ„ï¼šåˆ·æ–°åä¼šåœæ­¢ï¼‰
      load(2); music.volume=0.35; play(); break;
    case 'oceanMorning': // æµ·æ´‹æ¸…æ™¨ = æµ·æµª + æ¸…äº®éŸ³ä¹
      envSelect.value='ocean'; envVol.value=0.35; envEl.src='audio/ocean-2.mp3'; envEl.volume=0.35; envEl.loop=true;
      try{ await envEl.play(); }catch{}
      load(0); music.volume=0.5; play(); break;
  }
};
</script>

<footer style="text-align:center;opacity:.8;padding:24px 0">Â© 2025 Dodva Universe</footer>
</body>
</html>
