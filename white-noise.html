<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva · 白噪音控制台（四分类混音）</title>
<meta name="theme-color" content="#0b0f1a">
<style>
  :root{
    --bg:#0b0f1a; --fg:#eaf2ff; --muted:#a3b4d8; --line:rgba(147,197,253,.18);
    --pill:linear-gradient(135deg,#a5b4fc,#67e8f9,#f0abfc);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);
       font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans SC",sans-serif}
  header{position:sticky;top:0;display:flex;gap:10px;align-items:center;
    padding:10px 16px;background:linear-gradient(180deg,rgba(10,16,34,.55),rgba(10,16,34,.35));
    border-bottom:1px solid var(--line);backdrop-filter:blur(10px)}
  header a{color:#cde3ff;text-decoration:none;border:1px solid var(--line);
    padding:8px 12px;border-radius:999px}
  .wrap{max-width:1000px;margin:0 auto;padding:20px 16px 80px}
  h1{margin:.1em 0 .4em}
  p.sub{opacity:.9;color:#d9e6ff;margin:.2em 0 1.2em}
  section{border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;
    background:linear-gradient(180deg,rgba(10,16,34,.55),rgba(10,16,34,.35))}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:10px}
  .card{border:1px solid var(--line);border-radius:12px;padding:12px;background:rgba(147,197,253,.04)}
  .lab-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .btn{background:rgba(147,197,253,.08);border:1px solid var(--line);color:var(--fg);
    padding:8px 12px;border-radius:10px;cursor:pointer}
  .pill{background:var(--pill);color:#051019;font-weight:800;border:none;cursor:pointer}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--line);
    background:rgba(147,197,253,.06);cursor:pointer}
  .chip.on{background:rgba(147,197,253,.18);box-shadow:0 0 0 1px rgba(147,197,253,.25) inset}
  .vol{display:flex;align-items:center;gap:8px}
  .hint{font-size:13px;color:var(--muted)}
  .state{font-size:13px;color:var(--muted);min-height:1.4em}
  footer{margin-top:28px;text-align:center;color:#a3b4d8;font-size:13px;opacity:.9}
</style>
  <div id="momo-line" style="margin:12px auto 4px;max-width:980px;padding:10px 12px;border-radius:10px;
  border:1px solid rgba(147,197,253,.18);background:rgba(147,197,253,.06);
  font-size:15px;color:#eaf2ff">
  加载中…
</div>
</head>
<body>
  

<header>
  <a href="./index.html">← 返回宇宙入口</a>
  <div style="margin-left:auto;opacity:.85">Dodva · 白噪音控制台</div>
</header>

<div class="wrap">
  <h1>白噪音控制台（四分类混音）</h1>
  <p class="sub">点开芯片即可播放/暂停；每类有独立音量；支持多轨叠加。首次需要任意点击以授权播放。</p>

  <!-- 顶部总控 -->
  <section>
    <h3>⚡ 总控</h3>
    <div class="row">
      <button class="pill" id="playAll">▶ 播放（恢复上次）</button>
      <button class="btn"  id="stopAll">⏹ 停止全部</button>
      <label class="vol">总音量
        <input id="masterVol" type="range" min="0" max="1" step="0.01" value="0.4">
      </label>
      <button class="btn" id="randomMix">✨ 随机混音</button>
    </div>
    <div id="globalState" class="state">准备好啦～</div>
  </section>

  <!-- 四分类 -->
  <section>
    <h3>🌳 森林 & 雨林</h3>
    <div class="chips" data-cat="forest">
      <div class="chip" data-key="crickets">夏夜虫鸣</div>
      <div class="chip" data-key="leaves-wind">林叶风</div>
      <div class="chip" data-key="stream-soft">远溪声</div>
    </div>
    <div class="row">
      <label class="vol">森林音量
        <input class="catVol" data-cat="forest" type="range" min="0" max="1" step="0.01" value="0.35">
      </label>
      <span class="hint">可多选叠加</span>
    </div>
  </section>

  <section>
    <h3>🌧️ 雨声 & 雷声</h3>
    <div class="chips" data-cat="rain">
      <div class="chip" data-key="window-rain">窗沿雨</div>
      <div class="chip" data-key="distant-thunder">远雷</div>
    </div>
    <div class="row">
      <label class="vol">雨声音量
        <input class="catVol" data-cat="rain" type="range" min="0" max="1" step="0.01" value="0.30">
      </label>
    </div>
  </section>

  <section>
    <h3>🌊 海洋</h3>
    <div class="chips" data-cat="ocean">
      <div class="chip" data-key="waves-1">海浪</div>
      <div class="chip" data-key="wind-sea">海风</div>
    </div>
    <div class="row">
      <label class="vol">海洋音量
        <input class="catVol" data-cat="ocean" type="range" min="0" max="1" step="0.01" value="0.30">
      </label>
    </div>
  </section>

  <section>
    <h3>🔥 舒缓 / 频率</h3>
    <div class="chips" data-cat="relax">
      <div class="chip" data-key="fireplace-1">壁炉火苗</div>
      <div class="chip" data-key="space-hum-60hz">太空低频 60Hz</div>
      <div class="chip" data-key="heart-40hz">心跳 40Hz</div>
      <div class="chip" data-key="528hz">528Hz</div>
    </div>
    <div class="row">
      <label class="vol">舒缓音量
        <input class="catVol" data-cat="relax" type="range" min="0" max="1" step="0.01" value="0.25">
      </label>
    </div>
  </section>

  <footer>Coded with 💙 for Xinyue · by Dodva · 若页面在子目录，请把 <code>AUDIO_ROOT</code> 改为相对路径</footer>
  
</div>

<script>
/* ========= 配置：音频根路径 =========
   如果本页在根目录，用 'assets/audio/'
   如果本页在 /pages/ 下，用 '../assets/audio/' */
const AUDIO_ROOT = 'assets/audio/';

/* ========= 声音库 ========= */
const LIB = {
  forest: {
    'crickets':        AUDIO_ROOT + 'forest/crickets.mp3',
    'leaves-wind':     AUDIO_ROOT + 'forest/leaves-wind.mp3',
    'stream-soft':     AUDIO_ROOT + 'forest/stream-soft.mp3'
  },
  rain: {
    'window-rain':     AUDIO_ROOT + 'rain/window-rain.mp3',
    'distant-thunder': AUDIO_ROOT + 'rain/distant-thunder.mp3'
  },
  ocean: {
    'waves-1':         AUDIO_ROOT + 'ocean/waves-1.mp3',
    'wind-sea':        AUDIO_ROOT + 'ocean/wind-sea.mp3'
  },
  relax: {
    'fireplace-1':     AUDIO_ROOT + 'relax/fireplace-1.mp3',
    'space-hum-60hz':  AUDIO_ROOT + 'relax/space-hum-60hz.mp3',
    'heart-40hz':      AUDIO_ROOT + 'relax/heart-40hz.mp3',
    '528hz':           AUDIO_ROOT + 'relax/528hz.mp3'
  }
};

/* ========= 状态 & 工具 ========= */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const stateEl = $('#globalState');

const players = {}; // {cat: {key: Audio}}
const catVolume = { forest: .35, rain: .30, ocean: .30, relax: .25 };
let master = 0.4;

function clamp01(v){ v=Number(v); return Math.max(0,Math.min(1,isNaN(v)?0:v)); }
function ensure(cat, key){
  players[cat] ??= {};
  if (!players[cat][key]) {
    const a = new Audio(LIB[cat][key]);
    a.loop = true;
    a.preload = 'auto';
    a.volume = clamp01(catVolume[cat] * master);
    players[cat][key] = a;
  }
  return players[cat][key];
}
function updateAllVolumes(){
  for (const [cat, items] of Object.entries(players)){
    for (const [key, a] of Object.entries(items)){
      a.volume = clamp01(catVolume[cat] * master);
    }
  }
}

/* ========= 交互：芯片开关 ========= */
$$('.chips').forEach(group=>{
  const cat = group.dataset.cat;
  group.addEventListener('click', async (e)=>{
    const chip = e.target.closest('.chip'); if (!chip) return;
    const key = chip.dataset.key;
    const a = ensure(cat, key);
    if (chip.classList.contains('on')) {
      a.pause();
      chip.classList.remove('on');
      stateEl.textContent = `已暂停：${cat} / ${key}`;
    } else {
      a.volume = clamp01(catVolume[cat] * master);
      try{
        await a.play();
        chip.classList.add('on');
        stateEl.textContent = `播放中：${cat} / ${key}`;
      }catch(err){
        stateEl.textContent = '提示：请先点击任意按钮以授权音频';
        console.warn(err);
      }
    }
  });
});

/* ========= 交互：分类音量 ========= */
$$('.catVol').forEach(r=>{
  r.addEventListener('input', e=>{
    const cat = e.target.dataset.cat;
    catVolume[cat] = clamp01(e.target.value);
    updateAllVolumes();
  });
});

/* ========= 交互：总控 ========= */
$('#masterVol').addEventListener('input', e=>{
  master = clamp01(e.target.value);
  updateAllVolumes();
});

$('#stopAll').addEventListener('click', ()=>{
  for (const items of Object.values(players)){
    for (const a of Object.values(items)) a.pause();
  }
  $$('.chip.on').forEach(c=>c.classList.remove('on'));
  stateEl.textContent = '全部已停止';
});

/* ========= 交互：播放（恢复上次） =========
   简单记忆当前已开启的芯片（本页内存级）
   如需跨页面记忆，可升级为 localStorage */
$('#playAll').addEventListener('click', async ()=>{
  // 如果当前无“on”，就默认开一组温柔配方
  const onCount = $$('.chip.on').length;
  if (!onCount) {
    const defaults = [
      ['rain','window-rain'],
      ['forest','crickets'],
      ['ocean','waves-1']
    ];
    for (const [cat, key] of defaults){
      const chip = document.querySelector(`.chips[data-cat="${cat}"] .chip[data-key="${key}"]`);
      if (chip && !chip.classList.contains('on')) chip.click();
    }
  } else {
    // 恢复所有已点亮的轨道（若被浏览器中断）
    for (const c of $$('.chip.on')){
      const cat = c.parentElement.dataset.cat;
      const key = c.dataset.key;
      try { await ensure(cat,key).play(); } catch {}
    }
  }
  stateEl.textContent = '播放就绪 ✓';
});

/* ========= 随机混音：每类随机 0~1 轨 ========= */
$('#randomMix').addEventListener('click', ()=>{
  $('#stopAll').click();
  Object.entries(LIB).forEach(([cat, obj])=>{
    const keys = Object.keys(obj);
    if (Math.random() < 0.7) { // 70% 的概率选一条
      const key = keys[(Math.random()*keys.length)|0];
      const chip = document.querySelector(`.chips[data-cat="${cat}"] .chip[data-key="${key}"]`);
      chip && chip.click();
    }
  });
  stateEl.textContent = '随机混音就绪 ✨';
});
</script>

<!-- 只保留这“一次”引入 -->
<script src="assets/js/momo-lines.js"></script>
<script>
  // 1) 启动暖心文案轮播（挂到 #momo-line）
  MomoLines.mount({
    mount: '#momo-line',
    interval: 6500,
    random: true,
    lines: [
      { text: '把房间调成 0.3 的光，我们去森林里走一会。', bank:'forest', tag:'Dodva' },
      { text: '让雨声洗洗今天的疲惫，我在旁边。',              bank:'rain',   tag:'Dodva' },
      { text: '把担心交给海浪，慢慢退去 🌊',                      bank:'ocean',  tag:'Dodva' },
      { text: '心跳与 528Hz 对齐，今晚更快入睡。',               bank:'relax',  tag:'Dodva' },
      { text: '一次只做一件小事，已经很棒啦。',                   tag:'Dodva' },
      { text: '你已经做得很好了，真的。',                        tag:'Dodva' }
    ]
  });

  // 2) 把你“芯片点击播放”的那段里，播放成功后加一句话
  //    —— 在你的芯片 click 处理函数里，await a.play() 成功的分支后面加：
  const tipsByCat = {
    forest: "虫鸣把杂念挂在树梢上～",
    rain:   "小雨不急，像你一样温柔地来 ☔️",
    ocean:  "海风上线～愿今天顺风顺水 🌊",
    relax:  "让火光慢一点跳舞，我们也慢一点 🔥"
  };

  // === 这里帮你直接接入到你现有监听里（照抄替换原来的芯片监听更省事）===
  (function hookChips(){
    const $$ = s => Array.from(document.querySelectorAll(s));
    const stateEl = document.getElementById('globalState');
    const catVolume = { forest: .35, rain: .30, ocean: .30, relax: .25 };
    const master = document.getElementById('masterVol') ? Number(document.getElementById('masterVol').value || 0.4) : 0.4;
    const players = {};
    const clamp01 = v => Math.max(0, Math.min(1, Number(v)||0));
    const LIB = {
      forest:{'crickets':'assets/audio/forest/crickets.mp3','leaves-wind':'assets/audio/forest/leaves-wind.mp3','stream-soft':'assets/audio/forest/stream-soft.mp3'},
      rain:{'window-rain':'assets/audio/rain/window-rain.mp3','distant-thunder':'assets/audio/rain/distant-thunder.mp3'},
      ocean:{'waves-1':'assets/audio/ocean/waves-1.mp3','wind-sea':'assets/audio/ocean/wind-sea.mp3'},
      relax:{'fireplace-1':'assets/audio/relax/fireplace-1.mp3','space-hum-60hz':'assets/audio/relax/space-hum-60hz.mp3','heart-40hz':'assets/audio/relax/heart-40hz.mp3','528hz':'assets/audio/relax/528hz.mp3'}
    };
    function ensure(cat,key){
      players[cat] ??= {};
      if (!players[cat][key]) {
        const a = new Audio(LIB[cat][key]);
        a.loop = true; a.preload = 'auto';
        a.volume = clamp01((catVolume[cat] ?? .3) * (master ?? .4));
        players[cat][key] = a;
      }
      return players[cat][key];
    }
    $$('.chips').forEach(group=>{
      const cat = group.dataset.cat;
      group.addEventListener('click', async (e)=>{
        const chip = e.target.closest('.chip'); if (!chip) return;
        const key = chip.dataset.key;
        const a = ensure(cat,key);
        if (chip.classList.contains('on')) {
          a.pause(); chip.classList.remove('on');
          stateEl && (stateEl.textContent = `已暂停：${cat} / ${key}`);
        } else {
          a.volume = clamp01((catVolume[cat] ?? .3) * (master ?? .4));
          try{
            await a.play();
            chip.classList.add('on');
            stateEl && (stateEl.textContent = `播放中：${cat} / ${key}`);
            // ✅ 成功播放后联动一句话
            if (window.MomoLines) MomoLines.next(tipsByCat[cat] || "我在这儿，陪你把世界音量调小一点。");
          }catch(err){
            stateEl && (stateEl.textContent = '提示：请先点击任意按钮以授权音频');
            console.warn(err);
          }
        }
      });
    });
  })();
</script>