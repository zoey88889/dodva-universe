<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dodva · 极简白噪音控制台</title>
<style>
  :root{--bg:#0b0f1a;--fg:#eaf2ff;--sub:#a3b4d8;--line:rgba(147,197,253,.18)}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans SC",sans-serif}
  header{padding:14px 16px;border-bottom:1px solid var(--line)}
  h1{margin:0;font-size:20px}
  .wrap{max-width:1000px;margin:0 auto;padding:18px 14px 60px}
  .grid{display:grid;gap:14px}
  @media (min-width:880px){.grid{grid-template-columns:1fr 1fr}}
  section{border:1px solid var(--line);border-radius:14px;padding:14px;background:rgba(147,197,253,.06)}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  select,button,input[type=range]{background:rgba(147,197,253,.08);border:1px solid var(--line);color:var(--fg);padding:8px 10px;border-radius:10px}
  button{cursor:pointer}
  .hint{font-size:13px;color:var(--sub)}
  .card{border:1px solid var(--line);border-radius:12px;padding:12px;background:rgba(147,197,253,.04);margin-top:10px}
  .card h4{margin:0 0 8px 0}
  .state{font-size:13px;color:var(--sub);min-height:1.4em}
</style>
</head>
<body>
<header><h1>Dodva · 极简白噪音控制台</h1></header>

<div class="wrap">
  <div class="grid">
    <!-- 功能1｜单纯白噪音（单轨快捷播放：你的旧版） -->
    <section>
      <h3>功能1｜单纯白噪音（单轨）</h3>
      <div class="row" style="margin:6px 0 10px">
        <label>场景：
          <select id="quickSel">
            <option value="off">关闭</option>
            <option value="forest">🌳 森林</option>
            <option value="rain">🌧️ 雨声</option>
            <option value="ocean">🌊 海洋</option>
            <option value="relax">🔊 舒缓/频率</option>
          </select>
        </label>
        <button id="quickPlay">▶ 播放</button>
        <button id="quickStop">⏹ 停止</button>
        <label>音量 <input id="quickVol" type="range" min="0" max="1" step="0.01" value="0.30"></label>
      </div>
      <div id="quickState" class="state">提示：首次需点任意按钮授权音频。</div>
      <div class="hint">一次只播放一个场景（最接近你第一版的使用方式）。</div>
    </section>

    <!-- 功能2｜精简混音实验室（多轨叠加：我的新版） -->
    <section>
      <h3>功能2｜混音实验室（多轨叠加）</h3>

      <div class="card" data-bank="forest">
        <h4>🌳 森林</h4>
        <div class="row">
          <button class="toggle">开启</button>
          <label>音量 <input class="vol" type="range" min="0" max="1" step="0.01" value="0.35"></label>
        </div>
        <div class="state">内容：虫鸣 / 林叶风 / 远溪声（随机其一）</div>
      </div>

      <div class="card" data-bank="rain">
        <h4>🌧️ 雨声</h4>
        <div class="row">
          <button class="toggle">开启</button>
          <label>音量 <input class="vol" type="range" min="0" max="1" step="0.01" value="0.30"></label>
        </div>
        <div class="state">内容：窗沿雨 / 远雷（随机其一）</div>
      </div>

      <div class="card" data-bank="ocean">
        <h4>🌊 海洋</h4>
        <div class="row">
          <button class="toggle">开启</button>
          <label>音量 <input class="vol" type="range" min="0" max="1" step="0.01" value="0.30"></label>
        </div>
        <div class="state">内容：海浪 / 海风（随机其一）</div>
      </div>

      <div class="card" data-bank="relax">
        <h4>🔊 舒缓/频率</h4>
        <div class="row">
          <button class="toggle">开启</button>
          <label>音量 <input class="vol" type="range" min="0" max="1" step="0.01" value="0.20"></label>
        </div>
        <div class="state">内容：壁炉 / 太空嗡鸣 / 心跳40Hz / 528Hz（随机其一）</div>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="stopAll">⏹ 一键全停</button>
        <span class="hint">可同时开启多轨，按你喜欢自由叠加。</span>
      </div>
    </section>
  </div>

  <p class="hint" style="margin-top:14px">
  
  </p>
</div>

<script>
(function(){
  // —— 素材路径（与你的目录一致）——
  const BANKS = {
    forest: [
      'assets/audio/forest/crickets.mp3',
      'assets/audio/forest/leaves-wind.mp3',
      'assets/audio/forest/stream-soft.mp3'
    ],
    rain: [
      'assets/audio/rain/window-rain.mp3',
      'assets/audio/rain/distant-thunder.mp3'
    ],
    ocean: [
      'assets/audio/ocean/waves-1.mp3',
      'assets/audio/ocean/wind-sea.mp3'
    ],
    relax: [
      'assets/audio/relax/fireplace-1.mp3',
      'assets/audio/relax/space-hum-60hz.mp3',
      'assets/audio/relax/heart-40hz.mp3',
      'assets/audio/relax/528hz.mp3'
    ]
  };

  const LABELS = { forest:'森林', rain:'雨声', ocean:'海洋', relax:'舒缓/频率' };
  const pick = arr => arr[Math.floor(Math.random()*arr.length)];
  const clamp01 = v => Math.max(0, Math.min(1, Number(v)||0));

  // ========= 功能1｜单纯白噪音（单轨） =========
  const quickSel   = document.getElementById('quickSel');
  const quickPlay  = document.getElementById('quickPlay');
  const quickStop  = document.getElementById('quickStop');
  const quickVol   = document.getElementById('quickVol');
  const quickState = document.getElementById('quickState');

  const quickAudio = new Audio();
  quickAudio.loop = true; quickAudio.preload = 'auto';
  quickAudio.volume = clamp01(quickVol.value);

  quickPlay.addEventListener('click', async ()=>{
    const key = quickSel.value;
    if (key === 'off') { stopQuick(); return; }
    const list = BANKS[key]; if (!list) return;
    quickAudio.src = pick(list);
    quickAudio.volume = clamp01(quickVol.value);
    try{
      await quickAudio.play();
      quickState.textContent = '正在播放：' + (LABELS[key]||key);
    }catch(e){
      quickState.textContent = '提示：请先点击本按钮授权音频再播放';
      console.warn(e);
    }
  });

  function stopQuick(){
    quickAudio.pause();
    quickAudio.removeAttribute('src');
    quickAudio.load();
    quickState.textContent = '已停止';
  }
  quickStop.addEventListener('click', stopQuick);
  quickVol.addEventListener('input', e=> quickAudio.volume = clamp01(e.target.value));

  // ========= 功能2｜混音实验室（多轨叠加） =========
  const mixers = {}; // key -> {audio,on,volEl,stateEl,btn}
  document.querySelectorAll('.card[data-bank]').forEach(card=>{
    const key     = card.dataset.bank;
    const btn     = card.querySelector('.toggle');
    const volEl   = card.querySelector('.vol');
    const stateEl = card.querySelector('.state');

    const a = new Audio();
    a.loop = true; a.preload = 'auto'; a.volume = clamp01(volEl.value);
    mixers[key] = { audio:a, on:false, volEl, stateEl, btn };

    btn.addEventListener('click', async ()=>{
      if (!mixers[key].on){
        const list = BANKS[key]; if (!list) return;
        a.src = pick(list);
        a.volume = clamp01(volEl.value);
        try{
          await a.play();
          mixers[key].on = true;
          btn.textContent = '已开启';
          stateEl.textContent = `播放中：${LABELS[key]||key}`;
        }catch(e){
          stateEl.textContent = '提示：先点一次按钮以授权音频';
          console.warn(e);
        }
      }else{
        a.pause(); a.removeAttribute('src'); a.load();
        mixers[key].on = false;
        btn.textContent = '开启';
        stateEl.textContent = '已停止';
      }
    });

    volEl.addEventListener('input', e=>{
      a.volume = clamp01(e.target.value);
    });
  });

  document.getElementById('stopAll').addEventListener('click', ()=>{
    // 停混音
    Object.values(mixers).forEach(m=>{
      try{ m.audio.pause(); m.audio.removeAttribute('src'); m.audio.load();
           m.on=false; m.btn.textContent='开启'; m.stateEl.textContent='已停止'; }catch(_){}
    });
    // 停单轨
    stopQuick();
  });

  // 离开页面时安全停止
  window.addEventListener('pagehide', ()=>{
    stopQuick();
    Object.values(mixers).forEach(m=>{ try{ m.audio.pause(); }catch(_){ } });
  });
})();
</script>
<footer style="text-align:center; color:#ccc; margin-top:20px; font-size:14px;">
  Coded with love for Xinyue · by Dodva 💫
</footer>
</body>
</html>
