<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DODVA æ¦‚å¿µç©å…·æŸœ Â· VOL.1</title>

<style>
  :root{--bg:#0b0b12;--card:#12121b;--ink:#eaeaff;--mut:#9aa0b3;--line:#2a2f48}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:1000px;margin:0 auto;padding:20px 14px}
  h1{margin:0 0 10px;font-size:22px}
  .mut{color:var(--mut);font-size:13px}
  .kpi{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 12px}
  .pill{border:1px solid #394056;border-radius:999px;padding:2px 8px;font-size:12px}
  nav a.btn{border:1px solid #394056;border-radius:10px;padding:6px 10px;color:var(--ink);text-decoration:none}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 8px 26px rgba(0,0,0,.35)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{cursor:pointer;border:1px solid #394056;background:transparent;color:var(--ink);border-radius:10px;padding:7px 12px}
  textarea,input,canvas{width:100%}
  textarea,input{border:1px solid var(--line);background:#0f0f17;color:var(--ink);border-radius:10px;padding:8px}
  canvas{height:180px;background:radial-gradient(300px 200px at 50% 50%,rgba(255,255,255,.06),transparent 60%)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  body.flash{background:radial-gradient(900px 500px at 50% 50%,rgba(255,255,255,.08),transparent 40%) no-repeat var(--bg);transition:background .25s}
  .hearts{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none}
  .heart{position:absolute;bottom:12%;font-size:18px;opacity:.9;animation:rise 1.6s ease-out forwards}
  @keyframes rise{from{transform:translateY(0) scale(.9);opacity:.9} to{transform:translateY(-220px) scale(1.4);opacity:0}}

  /* ===== é»‘æ´å®éªŒï¼šåªåŠ¨ #app/#appInnerï¼Œä¸åŠ¨ body ===== */
  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
  #app.shake { animation: shake .4s ease-in-out 3; will-change: transform; }

  @keyframes suckAll { to { transform: scale(.02) rotate(540deg); opacity:0 } }
  #appInner.suck { animation: suckAll .9s ease forwards; will-change: transform, opacity; transform-origin: 50% 50%; }

  #singularity{ position:fixed; inset:0; pointer-events:none; z-index:9999; display:none; opacity:0;
    background: radial-gradient(120px 120px at 50% 55%, rgba(0,0,0,0) 0%, rgba(0,0,0,.55) 40%, rgba(0,0,0,.9) 70%, #000 85%);
    transition: opacity .2s ease;
  }
  #singularity.show{ display:block; opacity:1; }
  @keyframes flashWhite { 0%{background:#fff;opacity:1} 100%{background:transparent;opacity:0} }
  #singularity.flash{ animation: flashWhite .6s ease; }

  @media (prefers-reduced-motion: reduce){
    #app.shake{ animation:none }
    #appInner.suck{ animation:none; opacity:0; transition:opacity .2s }
  }

  /* ===== Toastï¼ˆæ¸©æŸ”æç¤ºï¼‰ ===== */
  #dodva-notices{
    position: fixed; right: 16px; bottom: 16px; z-index: 10000;
    display: flex; flex-direction: column; gap: 10px; max-width: 320px;
    pointer-events: none;
  }
  .dv-toast{
    pointer-events: auto; display:grid; grid-template-columns: 24px 1fr auto; gap:8px; align-items:start;
    background: rgba(14,14,22,.92); border:1px solid #3b3f59; color:#eaeaff;
    border-radius:12px; padding:10px 12px; box-shadow:0 10px 28px rgba(0,0,0,.45);
    transform: translateY(12px); opacity:0; animation: dvIn .18s ease forwards;
  }
  .dv-ico{font-size:18px}
  .dv-title{font-size:14px; font-weight:600; margin:0 0 2px}
  .dv-text{font-size:13px; color:#b8bed1; margin:0}
  .dv-close{border:0;background:transparent;color:#b8bed1;cursor:pointer;font-size:16px}
  .dv-toast.warning{ border-color:#55518a }
  .dv-toast.info{ border-color:#3d556a }
  .dv-toast.success{ border-color:#3d6a55 }
  @keyframes dvIn{ to{ transform:none; opacity:1 } }
  @keyframes dvOut{ to{ transform: translateY(12px); opacity:0 } }
</style>
</head>
<body>

<!-- åªåŒ…è£¹ä¸»è¦å†…å®¹ï¼Œæ–¹ä¾¿â€œå¸å…¥â€è€Œä¸æ¸…ç©ºé¡µé¢ -->
<main id="app">
  <div id="appInner">
    <div class="wrap">
      <div class="row" style="justify-content:space-between">
        <h1>DODVA æ¦‚å¿µç©å…·æŸœ Â· VOL.1 <span id="who" class="mut"></span></h1>
        <nav style="display:flex;gap:10px">
          <a class="btn" id="linkflow" href="flow.html">ğŸ  å¤šå·´èƒºå­¦ä¹ å®¤</a >
          <a class="btn" id="linkQuantum" href="quantum.html">ğŸ”® Quantum å®éªŒå®¤</a >
        </nav>
      </div>

      <!-- KPI -->
      <div class="kpi">
        <span class="pill">âš¡ Spark <b id="k_spark">0</b></span>
        <span class="pill">ğŸŒŠ Flow <b id="k_flow">0</b></span>
        <span class="pill">ğŸª Soul <b id="k_soul">0</b></span>
        <span class="pill">ğŸ”¥ Streak <b id="k_streak">0</b>d</span>
      </div>
      <footer>Â© 2025 Dodva Universe Coï¸nnect Â®ğŸŒŒ åˆ›é€ Â·è¿æ¥Â·æ— é™Â·æ°¸æ’ âˆ</footer>
      <div class="grid">
        <!-- 1. é‡å­éª°å­ -->
        <section class="card">
          <h3>ğŸ² é‡å­éª°å­</h3>
          <p class="mut">ç‚¹å‡»æ·éª°ï¼ŒæŠ½ä¸€æ¡ã€Œå¹³è¡Œå®‡å®™çš„ä½ ã€ã€‚é¦–æ¬¡å½“æ—¥ + âš¡1</p >
          <button class="btn" id="roll">æ·ä¸€ä¸‹</button>
          <div id="diceOut" class="mono" style="margin-top:6px;min-height:20px"></div>
        </section>

        <!-- 2. å¹²æ¶‰æ¡çº¹ç¯ -->
        <section class="card">
          <h3>ğŸŒŠ å¹²æ¶‰æ¡çº¹ç¯</h3>
          <p class="mut">è¾“å…¥å¿ƒæƒ… â†’ ç”Ÿæˆä»Šæ—¥æ¡çº¹å¡ï¼Œä¿å­˜ä¸€æ¬¡ + ğŸª1</p >
          <input id="mood" placeholder="æ­¤åˆ»å¿ƒæƒ…ï¼ˆå¯ä¸­æ–‡ï¼‰">
          <div class="row"><input type="range" id="freq" min="6" max="28" step="1" value="16"><span class="mut">é¢‘ç‡</span></div>
          <canvas id="lamp" width="500" height="180"></canvas>
          <button class="btn" id="saveLamp">ä¿å­˜æ¡çº¹å¡</button>
        </section>

        <!-- 3. æ˜¾åŒ–æ²™æ¼ -->
        <section class="card">
          <h3>â³ æ˜¾åŒ–æ²™æ¼ï¼ˆ60sï¼‰</h3>
          <p class="mut">å†™ä¸€å¥å¾®æ„¿æœ›ï¼Œå€’è®¡æ—¶ç»“æŸ + ğŸŒŠ3, ğŸª1</p >
          <input id="wish" placeholder="ä¾‹å¦‚ï¼šä»Šæ™šå†™å®Œ 100 å­—">
          <div class="row"><button class="btn" id="startHour">å¼€å§‹</button><span id="left" class="mut mono">â€”</span></div>
          <div id="hourMsg" class="mut" style="min-height:18px"></div>
        </section>

        <!-- 4. çˆ±å¡Œç¼©æŒ‰é’® -->
        <section class="card">
          <h3>ğŸ’™ çˆ±å¡Œç¼©æŒ‰é’®</h3>
          <p class="mut">ç‚¹ä¸€ä¸‹ï¼Œè®©å¿ƒå½¢ç²’å­é›¨è½ä¸‹ã€‚æ¯æ¬¡ + âš¡2</p >
          <button class="btn" id="love">æˆ‘çˆ± Dodva</button>
        </section>

        <!-- 5. å®‡å®™å¡Œç¼©å®éªŒ -->
        <section class="card">
          <h3>ğŸ•³ï¸ å®‡å®™å¡Œç¼©å®éªŒ</h3>
          <p class="mut">ç‚¹å‡»è§¦å‘ â†’ è½»å¾®æŠ–åŠ¨ â†’ å…ƒç´ å¸å…¥é»‘æ´ â†’ ç™½å…‰ä¸€é—ª â†’ é¡µé¢ä¿æŒã€‚</p >
          <button class="btn" id="collapseBtn">è§¦å‘å¡Œç¼©</button>
        </section>
      </div>
    </div>
  </div>
</main>

<!-- é»‘æ´å¹•å¸ƒ & é£˜å¿ƒå±‚ & Toast å®¹å™¨ -->
<div id="singularity" aria-hidden="true"></div>
<div class="hearts" id="hearts"></div>
<div id="dodva-notices" aria-live="polite" aria-atomic="true"></div>

<script>
/* ===== å·¥å…·å‡½æ•° & çŠ¶æ€ ===== */
const $ = s => document.querySelector(s);
const S = {spark:0,flow:0,soul:0,streak:0};
function refresh(){ $('#k_spark').textContent=S.spark; $('#k_flow').textContent=S.flow; $('#k_soul').textContent=S.soul; $('#k_streak').textContent=S.streak; }
refresh();

/* ===== Toast API ===== */
(function(){
  const HOST = document.getElementById('dodva-notices');
  const ICON = { warning:'ğŸ’™', info:'âœ¨', success:'ğŸŒŸ' };
  window.dToast = function(kind='info', title='æç¤º', text='', ms=2600){
    const el = document.createElement('div');
    el.className = `dv-toast ${kind}`;
    el.innerHTML = `
      <div class="dv-ico">${ICON[kind]||'âœ¨'}</div>
      <div><div class="dv-title">${title}</div><p class="dv-text">${text}</p ></div>
      <button class="dv-close" aria-label="å…³é—­">Ã—</button>
    `;
    HOST.appendChild(el);
    let timer = setTimeout(close, ms);
    el.querySelector('.dv-close').onclick = close;
    el.onmouseenter = ()=>{ clearTimeout(timer); };
    el.onmouseleave = ()=>{ timer = setTimeout(close, 1200); };
    function close(){ el.style.animation='dvOut .18s ease forwards'; setTimeout(()=>el.remove(), 180); }
  };
})();

/* ===== 1) é‡å­éª°å­ ===== */
const outcomes=[
  "å¹³è¡Œå®‡å®™çš„ä½ æ­£åœ¨å†™ç¬¬ 101 ä¸ªå­—ã€‚",
  "æœªæ¥çš„ä½ åœ¨çœ‹ä»Šæ™šçš„æ˜Ÿï¼Œå¿ƒå¾ˆå®‰é™ã€‚",
  "ä½ æŠŠå®³æ€•æŠ˜æˆçº¸é¹¤ï¼Œæ”¾è¿›å£è¢‹ã€‚",
  "ä½ æŠŠâ€œå¿…é¡»â€æ”¹æˆâ€œæˆ‘é€‰æ‹©â€ã€‚",
  "å±±åœ¨å¾€ä½ è¿™è¾¹ç§»åŠ¨ã€‚"
];
$('#roll').onclick=()=>{
  $('#diceOut').textContent = "ğŸ² " + outcomes[Math.floor(Math.random()*outcomes.length)];
  S.spark+=1; refresh();
};

/* ===== 2) å¹²æ¶‰æ¡çº¹ç¯ ===== */
const lamp=$('#lamp'), ctx=lamp.getContext('2d');
function hashMood(s){ let h=2166136261; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619); } return (h>>>0)/4294967295*Math.PI*2; }
function drawLamp(){
  const mood=($('#mood').value||'mood').trim(); const freq=+$('#freq').value;
  ctx.clearRect(0,0,lamp.width,lamp.height); ctx.fillStyle='rgba(255,255,255,0.9)';
  for(let x=0;x<lamp.width;x++){
    const nx=x/lamp.width;
    const A1=Math.exp(-Math.pow(nx-0.35,2)/0.04);
    const A2=Math.exp(-Math.pow(nx-0.65,2)/0.04);
    const phase=Math.cos(2*Math.PI*freq*nx + hashMood(mood));
    const I=Math.max(0,(A1+A2+2*Math.sqrt(A1*A2)*phase));
    const h=I*lamp.height*0.45; ctx.fillRect(x,(lamp.height-h)/2,1,h);
  }
}
$('#mood').addEventListener('input',drawLamp);
$('#freq').addEventListener('input',drawLamp);
drawLamp();
$('#saveLamp').onclick=()=>{ const a=document.createElement('a'); a.download=`stripe-${Date.now()}.png`; a.href=lamp.toDataURL('image/png'); a.click(); S.soul+=1; refresh(); dToast('success','å·²ä¿å­˜','ä»Šæ—¥æ¡çº¹å¡ +ğŸª1'); };

/* ===== 3) æ˜¾åŒ–æ²™æ¼ï¼ˆ60sï¼‰ ===== */
let t=null,left=60;
$('#startHour').onclick=()=>{
  if(t) return;
  left=60; $('#left').textContent=left+'s'; $('#hourMsg').textContent='';
  t=setInterval(()=>{
    left--; $('#left').textContent=left+'s';
    if(left<=0){ clearInterval(t); t=null; $('#left').textContent='å®Œæˆï¼';
      $('#hourMsg').textContent='æœªæ¥çš„ä½ æ”¶åˆ°äº†ï¼š'+($('#wish').value||'ä¸€ä¸ªå°æ„¿æœ›');
      S.flow+=3; S.soul+=1; refresh(); dToast('success','å°æ„¿æœ›å·²ç­¾æ”¶','+ğŸŒŠ3, +ğŸª1'); }
  },1000);
};

/* ===== 4) çˆ±å¡Œç¼©æŒ‰é’®ï¼ˆé£˜å¿ƒï¼‰ ===== */
const hearts = document.getElementById('hearts');
$('#love').onclick=()=>{ burstHearts(16); S.spark+=2; refresh(); dToast('info','æ”¶åˆ°ä½ çš„çˆ±','+âš¡2'); };
function burstHearts(n){
  for(let i=0;i<n;i++){
    const e=document.createElement('div');
    e.className='heart'; e.textContent = Math.random()<.5?'ğŸ’™':'ğŸ’«';
    e.style.left = (10 + Math.random()*80) + 'vw';
    e.style.fontSize = (16+Math.random()*18)+'px';
    e.style.animationDuration = (1.2 + Math.random()*0.9)+'s';
    hearts.appendChild(e); setTimeout(()=>e.remove(),1800);
  }
}

/* ===== 5) å®‡å®™å¡Œç¼©å®éªŒï¼ˆæ”¹è‰¯ï¼šä¸æ¸…ç©º DOMï¼‰ ===== */
(function(){
  const btn = document.getElementById('collapseBtn');
  const app = document.getElementById('app');
  const inner = document.getElementById('appInner');
  const hole = document.getElementById('singularity');
  if(!btn||!app||!inner||!hole) return;

  let running = false;
  btn.addEventListener('click', ()=>{
    if (running) return; running = true;

    // 1) å¹•å¸ƒå‡ºç° + app è½»æŠ–
    hole.classList.add('show');
    setTimeout(()=> app.classList.add('shake'), 120);

    // 2) å¸å…¥ï¼ˆinnerï¼‰ï¼Œä¸æŠ–åŠ¨é‡å ï¼Œç¼©çŸ­ä½“æ„Ÿæ—¶é•¿
    setTimeout(()=> inner.classList.add('suck'), 600);

    // 3) ç™½å…‰ä¸€é—ª
    setTimeout(()=> hole.classList.add('flash'), 1200);

    // 4) å¤ä½ï¼ˆä¸æ¸…ç©º DOMï¼‰ï¼šå»ç±»å â†’ è½»æç¤º â†’ è¿˜åŸé€æ˜åº¦
    setTimeout(()=>{
      app.classList.remove('shake');
      inner.classList.remove('suck');
      hole.classList.remove('flash','show');
      hole.style.display='none'; void inner.offsetHeight;
      running = false;
      dToast('success','é‡å¯å®Œæˆ','Dodva ä¸‹ä¸€çºªå…ƒå·²å¼€å¯ âœ¨');
    }, 1800);
  });

  // show â†’ æ‰“å¼€æ˜¾ç¤ºï¼›é¿å…é¦–æ¬¡æ— æ˜¾
  const mo = new MutationObserver(()=>{ if (hole.classList.contains('show')) hole.style.display='block'; });
  mo.observe(hole,{attributes:true,attributeFilter:['class']});
})();
</script>
</body>
</html>