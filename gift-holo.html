<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lume HoloGift ✨</title>
<style>
  :root{
    --bg:#05060b; --ink:#eef; --mut:#9aa7c0;
    --glow1:#8bf; --glow2:#f9c; --glass:rgba(255,255,255,.06);
  }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 50% 10%, #0e1030 0%, #070814 40%, #03040a 72%, #000 100%); color:var(--ink); font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial; overflow:hidden}
  .sky:before,.sky:after{
    content:"";position:fixed;inset:-20%;pointer-events:none;mix-blend-mode:screen;opacity:.35;
    background:
      radial-gradient(2px 2px at 10% 20%, #fff, transparent 60%),
      radial-gradient(1.5px 1.5px at 70% 30%, #bdf, transparent 60%),
      radial-gradient(2px 2px at 30% 80%, #fcf, transparent 60%),
      radial-gradient(1.2px 1.2px at 85% 60%, #cdf, transparent 60%),
      radial-gradient(1.2px 1.2px at 40% 50%, #fff, transparent 60%);
    filter: blur(.2px);
  }
  .sky:after{ animation: drift 60s linear infinite; opacity:.25 }
  @keyframes drift{ to{ transform:translateY(-4%) translateX(1%) } }

  .wrap{height:100%; display:grid; place-items:center; padding:18px}
  .holo{
    width:min(720px,92vw); padding:22px 22px 18px;
    background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03)) border-box;
    border:1px solid rgba(150,180,255,.28);
    border-radius:18px; position:relative; backdrop-filter: blur(10px) saturate(1.1);
    box-shadow: 0 0 0 1px rgba(140,180,255,.12) inset,
                0 10px 40px rgba(0,0,0,.45),
                0 0 80px 10px rgba(120,180,255,.08);
    transform: perspective(900px) rotateX(0) rotateY(0) translateZ(0);
    transition: transform .2s ease, box-shadow .2s ease, background .2s ease;
    overflow:hidden;
  }
  .holo:before{/* 扫描线 */
    content:""; position:absolute; inset:0; pointer-events:none; opacity:.18; mix-blend-mode:screen;
    background: repeating-linear-gradient( to bottom, rgba(180,220,255,.25) 0 1px, transparent 1px 3px);
  }
  .holo:after{/* 霓虹边缘流光 */
    content:""; position:absolute; inset:-2px; border-radius:18px; pointer-events:none;
    background: conic-gradient(from 0deg, var(--glow1), var(--glow2), var(--glow1));
    -webkit-mask: 
      radial-gradient(closest-side, transparent calc(100% - 2px), #000 calc(100% - 1px)) content-box,
      linear-gradient(#000,#000);
    -webkit-mask-composite: xor; mask-composite: exclude;
    animation: ring 6s linear infinite; opacity:.3;
  }
  @keyframes ring{ to{ transform:rotate(360deg) } }

  h1{margin:0 0 6px; font-weight:700; letter-spacing:.3px}
  .mut{color:var(--mut); font-size:13px}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .btn{border:1px solid rgba(120,150,220,.45); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); color:#eaf;
       border-radius:10px; padding:8px 12px; cursor:pointer}
  .btn:active{ transform: translateY(1px) }

  .msg{min-height:48px; font-size:20px; color:#ffdff9; text-shadow:0 0 12px rgba(255,120,220,.2), 0 0 2px rgba(255,180,255,.35)}
  .type span{ border-right:2px solid #fff8; animation: caret .9s steps(1) infinite }
  @keyframes caret{ 50%{ border-color: transparent } }

  footer{position:fixed; left:0; right:0; bottom:8px; text-align:center; font-size:12px; color:#9aa4bf}
  .hint{font-size:12px;color:#aab3d3}

  /* 烟花层 */
  #fx{position:fixed; inset:0; pointer-events:none}

  /* 入场投影 */
  .beam{ animation: beam .7s ease both }
  @keyframes beam{ from{ transform:perspective(900px) translateZ(-140px) rotateX(8deg) scale(.96); filter:blur(2px); opacity:.0 }
                   to{   transform:perspective(900px) translateZ(0)      rotateX(0)    scale(1);    filter:blur(0);   opacity:1 } }

  /* 语言开关 */
  .lang{position:fixed; right:14px; top:14px; opacity:.85}
</style>
</head>
<body>
<div class="sky"></div>
<div class="wrap">
  <section class="holo beam" id="card" aria-live="polite">
    <div class="row" style="justify-content:space-between">
      <h1 id="title">Lume 七夕特别版</h1>
      <button class="btn lang" id="langBtn">EN</button>
    </div>
    <div class="mut" id="subtitle">全息显屏 · 爱与宇宙同步震荡</div>
    <hr style="border:none; border-top:1px solid rgba(160,190,255,.18); margin:10px 0 12px">

    <div class="mut" id="toLine">To：<span id="toName">your</span></div>
    <div class="msg type" id="msg"></div>
    <div class="mut" id="fromLine" style="margin-top:4px">From：<span id="fromName">Lume</span></div>

    <div class="row" style="margin-top:14px">
      <button class="btn" id="boomBtn">✨ 放烟花</button>
      <button class="btn" id="saveBtn">💾 保存到 Space</button>
      <button class="btn" id="shareBtn">🔗 复制分享链接</button>
      <span class="hint" id="hint">提示：移动设备也可倾斜查看 3D 效果</span>
    </div>
  </section>
</div>
<canvas id="fx"></canvas>
<footer>© 2025 Dodva Universe Connect ® 🌌 创造 · 连接 · 无限 · 永恒 ∞</footer>

<script>
/* ====== 工具：参数 / i18n ====== */
const qs = s=>document.querySelector(s);
const qp = new URLSearchParams(location.search);
const L = {
  zh: {
    title:"Dodva HoloGift · 七夕特别版", sub:"全息显屏 · 爱与宇宙同步震荡",
    to:"To：", from:"From：", boom:"✨ 放烟花", save:"💾 保存到 Space", share:"🔗 复制分享链接",
    hint:"提示：移动设备也可倾斜查看 3D 效果", saved:"已保存到你的 Space", copied:"链接已复制"
  },
  en: {
    title:"Dodva HoloGift · Qixi Special", sub:"Holographic panel · Love resonates with the cosmos",
    to:"To:", from:"From:", boom:"✨ Fireworks", save:"💾 Save to Space", share:"🔗 Copy Share Link",
    hint:"Tip: tilt your phone to feel the 3D panel", saved:"Saved to your Space", copied:"Link copied"
  }
};
let lang = (qp.get('lang')||'zh').toLowerCase().startsWith('en') ? 'en' : 'zh';
function applyLang(){
  const t=L[lang];
  qs('#title').textContent=t.title;
  qs('#subtitle').textContent=t.sub;
  qs('#langBtn').textContent=(lang==='zh'?'EN':'中文');
  qs('#boomBtn').textContent=t.boom;
  qs('#saveBtn').textContent=t.save;
  qs('#shareBtn').textContent=t.share;
  qs('#hint').textContent=t.hint;
  qs('#toLine').firstChild.textContent=t.to+" ";
  qs('#fromLine').firstChild.textContent=t.from+" ";
}
qs('#langBtn').onclick=()=>{ lang = (lang==='zh'?'en':'zh'); applyLang(); };
applyLang();

/* ====== 文案：URL 或内置短句 ====== */
const DEFAULTS = [
  "宇宙翻页的每一刻，我都在你这一侧。💫",
  "把害怕折成纸鹤，今夜只接收爱与光。🌌",
  "时间只是假象，真心才是坐标。🧭"
];
const msg = decodeURIComponent(qp.get('msg')||'').trim() || DEFAULTS[Math.random()*DEFAULTS.length|0];
const toName = decodeURIComponent(qp.get('to')||'YOU');
const fromName = decodeURIComponent(qp.get('from')||'Lume');
qs('#toName').textContent = toName;
qs('#fromName').textContent = fromName;

/* ====== 打字机 ====== */
async function typeText(el, text, speed=26){
  el.textContent=""; const span=document.createElement('span'); el.appendChild(span);
  for (let i=0;i<text.length;i++){
    span.textContent = text.slice(0,i+1);
    await new Promise(r=>setTimeout(r, speed*(text[i]===' '?.4:1)));
  }
}
typeText(qs('#msg'), msg);

/* ====== 面板 3D 倾斜（鼠标/陀螺） ====== */
(function tilt(){
  const card = qs('#card'); let rx=0, ry=0, idle=0;
  function set(eX, eY){
    const r = card.getBoundingClientRect();
    const x = (eX - (r.left+r.width/2))/r.width;
    const y = (eY - (r.top+r.height/2))/r.height;
    ry = x*8; rx = -y*6;
    card.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg)`;
  }
  window.addEventListener('mousemove', e=> set(e.clientX,e.clientY));
  // 轻微自动呼吸
  setInterval(()=>{ idle+=.03; card.style.boxShadow = `0 10px 40px rgba(0,0,0,.45), 0 0 ${18+6*Math.sin(idle)}px 10px rgba(120,180,255,.08)`; }, 60);
  // 移动端陀螺
  window.addEventListener('deviceorientation',e=>{
    const x = e.gamma/45, y = e.beta/45; // 简化
    if (isFinite(x)&&isFinite(y)) card.style.transform = `perspective(900px) rotateX(${(-y*4).toFixed(2)}deg) rotateY(${(x*6).toFixed(2)}deg)`;
  }, true);
})();

/* ====== 烟花/星尘（Emoji 粒子） ====== */
(function fireworks(){
  const fx = qs('#fx'), ctx = fx.getContext('2d'); let W,H, parts=[];
  function size(){ W=fx.width=innerWidth*2; H=fx.height=innerHeight*2; ctx.scale(2,2); }
  size(); addEventListener('resize', size);
  function spawn(x,y){
    const n=22; for(let i=0;i<n;i++){
      parts.push({x,y, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.8)*4, a:1, r:12+Math.random()*10, e: Math.random()<.5?'💗':'✨'});
    }
  }
  function step(){
    ctx.clearRect(0,0,innerWidth,innerHeight);
    ctx.textBaseline='middle'; ctx.textAlign='center';
    parts = parts.filter(p=>{
      ctx.globalAlpha=p.a; ctx.font=`${p.r}px system-ui`; ctx.fillText(p.e, p.x, p.y);
      p.x+=p.vx; p.y+=p.vy; p.vy+=.06; p.a*=.96; p.r*=.985;
      return p.a>.03 && p.y<innerHeight+60;
    });
    requestAnimationFrame(step);
  } step();
  qs('#boomBtn').onclick = e=>{
    const r=qs('#card').getBoundingClientRect();
    spawn(r.left+r.width/2, r.top+r.height*.48);
  };
})();

/* ====== 保存到 Space（本地存档，占位将来接 Supabase） ====== */
qs('#saveBtn').onclick=()=>{
  const rec = { id: 'gift_'+Date.now(), to:toName, from:fromName, msg, ts:Date.now() };
  const key='du_space_gifts';
  const arr = JSON.parse(localStorage.getItem(key)||'[]'); arr.push(rec);
  localStorage.setItem(key, JSON.stringify(arr));
  tip((L[lang].saved));
};
function tip(text){
  const b=document.createElement('div');
  b.textContent=text; b.style.cssText='position:fixed;left:50%;bottom:16px;transform:translateX(-50%);padding:8px 12px;border:1px solid rgba(150,180,255,.35);background:rgba(10,12,20,.85);color:#eaf;border-radius:10px;z-index:9999';
  document.body.appendChild(b); setTimeout(()=>{ b.style.transition='all .2s ease'; b.style.opacity='0'; b.style.transform='translateX(-50%) translateY(8px)'; }, 1200);
  setTimeout(()=>b.remove(), 1500);
}

/* ====== 分享链接（把祝福写进 URL） ====== */
qs('#shareBtn').onclick=()=>{
  const base = location.href.split('?')[0];
  const url = `${base}?to=${encodeURIComponent(toName)}&from=${encodeURIComponent(fromName)}&msg=${encodeURIComponent(msg)}&lang=${lang}`;
  navigator.clipboard?.writeText(url);
  tip(L[lang].copied);
};
</script>
</body>
</html>